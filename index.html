<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>障害支援区分 80項目 聞き取り＋八咫烏015推定</title>
<style>
:root{--bg:#f3f4f6;--card:#fff;--txt:#111827;--sub:#6b7280;--bd:#e5e7eb;--pri:#2563eb;--ok:#047857;--warn:#b45309;}
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif;background:var(--bg);color:var(--txt)}
header{position:sticky;top:0;background:var(--card);border-bottom:1px solid var(--bd);padding:10px 14px;z-index:10}
h1{font-size:16px;margin:0}
main{max-width:1180px;margin:0 auto;padding:12px}
.grid{display:grid;grid-template-columns:1fr;gap:12px}
@media(min-width:980px){.grid{grid-template-columns:1.2fr .8fr}}
.card{background:var(--card);border:1px solid var(--bd);border-radius:14px;padding:12px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.card h2{font-size:14px;margin:0 0 8px}
.muted{color:var(--sub);font-size:12px;line-height:1.5}
label{display:block;font-size:12px;color:var(--sub);margin:8px 0 4px}
input,select,textarea{width:100%;border:1px solid var(--bd);border-radius:10px;padding:10px;font-size:14px;background:#fff}
textarea{min-height:76px;resize:vertical}
.btns{display:flex;gap:8px;flex-wrap:wrap}
button{border:1px solid var(--bd);background:#fff;border-radius:10px;padding:9px 10px;font-size:13px;cursor:pointer}
button.primary{background:var(--pri);border-color:var(--pri);color:#fff}
button:active{transform:translateY(1px)}
.toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:end}
.pill{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--bd);background:#fff;border-radius:999px;padding:6px 10px;font-size:12px;color:var(--sub)}
.kpi{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.kpi .box{border:1px solid var(--bd);border-radius:12px;padding:10px}
.kpi .v{font-size:18px;font-weight:900;margin-top:2px}
.ok{color:var(--ok)} .warn{color:var(--warn)}
.items{display:flex;flex-direction:column;gap:10px}
.item{border:1px solid var(--bd);border-radius:12px;padding:10px}
.item .top{display:flex;gap:8px;justify-content:space-between;align-items:flex-start;flex-wrap:wrap}
.code{font-weight:800}
.grp{font-size:11px;color:var(--sub)}
.opts{display:flex;flex-direction:column;gap:6px;margin-top:8px}
.opt{display:flex;gap:8px;align-items:flex-start;border:1px solid var(--bd);border-radius:12px;padding:8px}
.opt input{width:auto;margin-top:2px}
.opt .t{font-size:13px}
.small{font-size:12px;color:var(--sub)}
hr{border:none;border-top:1px solid var(--bd);margin:12px 0}
.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
details{border:1px solid var(--bd);border-radius:12px;padding:8px;background:#fff}
summary{cursor:pointer;font-weight:700}

.need-card{border-color:#ef4444;background:#fff1f2}
.need-badge{border-color:#ef4444;color:#b91c1c;background:#fff1f2}
.opt.need-opt{border-color:#fecaca;background:#fff1f2}
.opt.need-opt .t{color:#b91c1c;font-weight:700}

</style>
<script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>
</head>
<body>
<header>
  <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center">
    <h1>障害支援区分：聞き取り→80項目入力→不足チェック→特記事項下書き→八咫烏015推定</h1>
    <div class="btns">
      <button id="btnSave" class="primary">保存</button>
      <button id="btnXlsx">Excelで保存</button>
      <button id="btnExport">エクスポート(JSON)</button>
      <button id="btnImport">インポート(JSON)</button>
      <button id="btnReset">リセット</button>
    </div>
  </div>
</header>

<main class="grid">
  <section class="card">
    <h2>① 基本情報</h2>
    <div class="toolbar">
      <div style="flex:1;min-width:220px">
        <label>利用者名（またはID）</label>
        <input id="resident" placeholder="例：A-001 / 山田 太郎"/>
      </div>
      <div style="width:180px">
        <label>日付</label>
        <input id="date" type="date"/>
      </div>
      <div style="width:220px">
        <label>表示</label>
        <select id="showFilter">
          <option value="all">すべて</option>
          <option value="missing">未入力のみ</option>
          <option value="high">支援が重い/頻度高いのみ</option>
        </select>
      </div>
      <div style="flex:1;min-width:220px">
        <label>検索（番号/項目名）</label>
        <input id="q" placeholder="例：05 / 入浴 / 暴言"/>
      </div>
    </div>

    <div class="kpi" style="margin-top:10px">
      <div class="box">
        <div class="muted">未入力（80項目中）</div>
        <div class="v" id="kpiMissing">0</div>
        <div class="muted">不足一覧（先頭30件）</div>
        <div id="missingList" class="muted"></div>
      </div>
      <div class="box">
        <div class="muted">八咫烏015 推定（一次判定相当）</div>
        <div class="v"><span id="kpiKubun">—</span> <span class="small">(推定)</span></div>
        <div class="muted">該当ロジック：<span class="mono" id="kpiLogic">—</span> / p：<span class="mono" id="kpiP">—</span></div>
        <div class="muted">※公式判定の保証はありません（審査会・医師意見書要素は別）</div>
      </div>
    </div>

    <label style="margin-top:10px">聞き取りメモ（生活状況・支援実態）</label>
    <textarea id="interview" placeholder="例：夜間見守り頻度、外出時の付き添い、服薬管理、困りごと、事故リスク等"></textarea>

    <details style="margin-top:10px" open>
      <summary>② 80項目入力（質問テンプレ形式）</summary>
      <div class="muted" style="margin-top:8px">
        身体介助：1〜4／日常生活：1〜3／行動障害：1〜5 を統一表示。各項目に<strong>根拠メモ（特記事項向け）</strong>を付けられます。
      </div>
      <div class="items" id="items80" style="margin-top:10px"></div>
    </details>

    <details style="margin-top:10px">
      <summary>③ 追加（八咫烏用の補足項目：麻痺/拘縮/てんかん/二軸など）</summary>
      <div class="muted" style="margin-top:8px">
        八咫烏015のロジックで参照されることがある補足項目です。該当がなければ既定値のままでOKです。
      </div>
      <div class="items" id="itemsExtra" style="margin-top:10px"></div>
    </details>

  </section>

  <aside class="card">
    <h2>④ 特記事項（下書き）</h2>
    <div class="muted">入力内容と根拠メモから、自動で下書きを作ります（必要に応じて修正して使ってください）。</div>
    <label style="margin-top:10px">特記事項（下書き）</label>
    <textarea id="draft"></textarea>
    <div class="btns" style="margin-top:8px">
      <button id="btnDraft" class="primary">下書き生成</button>
      <button id="btnCopyDraft">コピー</button>
    </div>

    <hr>

    <h2>⑤ 推定の根拠（一致条件）</h2>
    <div id="why" class="muted">—</div>

    <hr>

    <h2>保存データ</h2>
    <div class="muted">端末内に保存（LocalStorage）します。複数人分はJSONで管理がおすすめ。</div>
  </aside>
</main>

<script>
const BASE80 = [{"row": 2, "name": "寝返り", "group": "起居動作", "formula": "=IF(F2=\"\",\"\",CHOOSE(F2,0,7.8,10.4,14.8))", "optCount": 4, "cat": "physical", "code": "01"}, {"row": 3, "name": "起き上がり", "group": "", "formula": "=IF(F3=\"\",\"\",CHOOSE(F3,0,6.2,8.9,15))", "optCount": 4, "cat": "physical", "code": "02"}, {"row": 4, "name": "座位保持", "group": "", "formula": "=IF(F4=\"\",\"\",CHOOSE(F4,0,6.8,11.6,15.9))", "optCount": 4, "cat": "physical", "code": "03"}, {"row": 5, "name": "両足立位", "group": "", "formula": "=IF(F5=\"\",\"\",CHOOSE(F5,0,7.2,9.4,14.5))", "optCount": 4, "cat": "physical", "code": "04"}, {"row": 6, "name": "歩行", "group": "", "formula": "=IF(F6=\"\",\"\",CHOOSE(F6,0,5.4,7.7,13.6))", "optCount": 4, "cat": "physical", "code": "05"}, {"row": 7, "name": "立ち上がり", "group": "", "formula": "=IF(F7=\"\",\"\",CHOOSE(F7,0,5.1,7.7,14.8))", "optCount": 4, "cat": "physical", "code": "06"}, {"row": 8, "name": "片足立位", "group": "=SUM(E2:E8)", "formula": "=IF(F8=\"\",\"\",CHOOSE(F8,0,2.8,3.4,11.4))", "optCount": 4, "cat": "physical", "code": "07"}, {"row": 9, "name": "じょくそう", "group": "生活機能 I", "formula": "=IF(F9=\"\",\"\",CHOOSE(F9,0,10.9))", "optCount": 2, "cat": "physical", "code": "08"}, {"row": 10, "name": "嚥下", "group": "", "formula": "=IF(F10=\"\",\"\",CHOOSE(F10,0,13.5,25.2))", "optCount": 3, "cat": "physical", "code": "09"}, {"row": 11, "name": "食事", "group": "", "formula": "=IF(F11=\"\",\"\",CHOOSE(F11,0,14.4,23.9))", "optCount": 3, "cat": "physical", "code": "10"}, {"row": 12, "name": "排尿", "group": "", "formula": "=IF(F12=\"\",\"\",CHOOSE(F12,0,11.6,20.1))", "optCount": 3, "cat": "physical", "code": "11"}, {"row": 13, "name": "排便", "group": "=SUM(E9:E13)", "formula": "=IF(F13=\"\",\"\",CHOOSE(F13,0,10.9,19.9))", "optCount": 3, "cat": "physical", "code": "12"}, {"row": 14, "name": "移乗", "group": "生活機能 II", "formula": "=IF(F14=\"\",\"\",CHOOSE(F14,0,6.6,10.7,15.9))", "optCount": 4, "cat": "physical", "code": "13"}, {"row": 15, "name": "移動", "group": "", "formula": "=IF(F15=\"\",\"\",CHOOSE(F15,0,5.8,10.8,17.1))", "optCount": 4, "cat": "physical", "code": "14"}, {"row": 16, "name": "入浴", "group": "", "formula": "=IF(F16=\"\",\"\",CHOOSE(F16,0,6.1, 16.2))", "optCount": 3, "cat": "physical", "code": "15"}, {"row": 17, "name": "口腔清潔", "group": "", "formula": "=IF(F17=\"\",\"\",CHOOSE(F17,0,6.9, 15.9))", "optCount": 3, "cat": "physical", "code": "16"}, {"row": 18, "name": "衣類の着脱", "group": "", "formula": "=IF(F18=\"\",\"\",CHOOSE(F18,0 ,6.9,12,18.2))", "optCount": 4, "cat": "physical", "code": "17"}, {"row": 19, "name": "健康・栄養管理", "group": "=SUM(E14:E19)", "formula": "=IF(F19=\"\",\"\",CHOOSE(F19,0,9.3,16.7))", "optCount": 3, "cat": "physical", "code": "18"}, {"row": 20, "name": "視力", "group": "視聴覚", "formula": "=IF(F20=\"\",\"\",CHOOSE(F20,0,2.8,7.3,25.5,28.3,48.9))", "optCount": 6, "cat": "comm", "code": "19"}, {"row": 21, "name": "聴力", "group": "=SUM(E20:E21)", "formula": "=IF(F21=\"\",\"\",CHOOSE(F21,0,6.4,9.1,9.1,9.1,51.1))", "optCount": 6, "cat": "comm", "code": "20"}, {"row": 22, "name": "調理", "group": "応用日常生活動作", "formula": "=IF(F22=\"\",\"\",CHOOSE(F22,0 ,9.4,20.2))", "optCount": 3, "cat": "daily", "code": "21"}, {"row": 23, "name": "掃除", "group": "", "formula": "=IF(F23=\"\",\"\",CHOOSE(F23,0 ,6.7,20.9))", "optCount": 3, "cat": "daily", "code": "22"}, {"row": 24, "name": "洗濯", "group": "", "formula": "=IF(F24=\"\",\"\",CHOOSE(F24,0 ,7 ,20.5))", "optCount": 3, "cat": "daily", "code": "23"}, {"row": 25, "name": "買い物", "group": "", "formula": "=IF(F25=\"\",\"\",CHOOSE(F25,0 ,7.9, 19.5))", "optCount": 3, "cat": "daily", "code": "24"}, {"row": 26, "name": "交通手段", "group": "=SUM(E22:E26)", "formula": "=IF(F26=\"\",\"\",CHOOSE(F26,0 , 6.9, 18.9))", "optCount": 3, "cat": "daily", "code": "25"}, {"row": 27, "name": "薬の管理", "group": "認知機能", "formula": "=IF(F27=\"\",\"\",CHOOSE(F27,0 , 3.3, 11))", "optCount": 3, "cat": "daily", "code": "26"}, {"row": 28, "name": "金銭の管理", "group": "", "formula": "=IF(F28=\"\",\"\",CHOOSE(F28,0 , 1.4, 9.5))", "optCount": 3, "cat": "daily", "code": "27"}, {"row": 29, "name": "電話等", "group": "", "formula": "=IF(F29=\"\",\"\",CHOOSE(F29,0 , 2.6, 10.7))", "optCount": 3, "cat": "daily", "code": "28"}, {"row": 30, "name": "日常の意思決定", "group": "", "formula": "=IF(F30=\"\",\"\",CHOOSE(F30,0 , 9.1, 15.6))", "optCount": 3, "cat": "daily", "code": "29"}, {"row": 31, "name": "読み書き", "group": "", "formula": "=IF(F31=\"\",\"\",CHOOSE(F31,0 , 4.1, 11.7))", "optCount": 3, "cat": "comm", "code": "30"}, {"row": 32, "name": "危険の認識", "group": "", "formula": "=IF(F32=\"\",\"\",CHOOSE(F32,0 , 4.1, 11.7))", "optCount": 3, "cat": "daily", "code": "31"}, {"row": 33, "name": "コミュニケーション", "group": "", "formula": "=IF(F33=\"\",\"\",CHOOSE(F33,0 , 4.1, 5.5, 11, 14.5))", "optCount": 5, "cat": "comm", "code": "32"}, {"row": 34, "name": "説明の理解", "group": "=SUM(E27:E34)", "formula": "=IF(F34=\"\",\"\",CHOOSE(F34,0 , 15.3, 15.3))", "optCount": 3, "cat": "comm", "code": "33"}, {"row": 35, "name": "被害的・拒否的", "group": "行動上の障害　A群", "formula": "=IF(F35=\"\",\"\",CHOOSE(F35,0 , 1.9, 2.1, 3.3, 4.6))", "optCount": 5, "cat": "behavior", "code": "34"}, {"row": 36, "name": "作話", "group": "", "formula": "=IF(F36=\"\",\"\",CHOOSE(F36,0 , 2.1, 2.1, 3.9, 5.3))", "optCount": 5, "cat": "behavior", "code": "35"}, {"row": 37, "name": "感情が不安定", "group": "", "formula": "=IF(F37=\"\",\"\",CHOOSE(F37,0 , 2.1, 2.6, 3.7, 5.4))", "optCount": 5, "cat": "behavior", "code": "36"}, {"row": 38, "name": "昼夜逆転", "group": "", "formula": "=IF(F38=\"\",\"\",CHOOSE(F38,0 ,2.1,2.9,3.5,3.5 ))", "optCount": 5, "cat": "behavior", "code": "37"}, {"row": 39, "name": "暴言暴行", "group": "", "formula": "=IF(F39=\"\",\"\",CHOOSE(F39,0 ,2.6,3, 4.4, 6.2 ))", "optCount": 5, "cat": "behavior", "code": "38"}, {"row": 40, "name": "同じ話をする", "group": "", "formula": "=IF(F40=\"\",\"\",CHOOSE(F40,0 ,2.1, 2.4, 3.3, 4.8 ))", "optCount": 5, "cat": "behavior", "code": "39"}, {"row": 41, "name": "大声・奇声を出す", "group": "", "formula": "=IF(F41=\"\",\"\",CHOOSE(F41,0, 2.7, 3, 4.1, 6  ))", "optCount": 5, "cat": "behavior", "code": "40"}, {"row": 42, "name": "支援の拒否", "group": "", "formula": "=IF(F42=\"\",\"\",CHOOSE(F42,0 , 2.8, 3.4, 4.3, 5.9 ))", "optCount": 5, "cat": "behavior", "code": "41"}, {"row": 43, "name": "徘徊", "group": "", "formula": "=IF(F43=\"\",\"\",CHOOSE(F43,0, 3.7, 3.8, 4.4, 6  ))", "optCount": 5, "cat": "behavior", "code": "42"}, {"row": 44, "name": "落ち着きがない", "group": "", "formula": "=IF(F44=\"\",\"\",CHOOSE(F44,0 ,4.4, 5, 5.5, 7 ))", "optCount": 5, "cat": "behavior", "code": "43"}, {"row": 45, "name": "外出して戻れない", "group": "", "formula": "=IF(F45=\"\",\"\",CHOOSE(F45,0 ,3.3, 4.3, 4.3, 5  ))", "optCount": 5, "cat": "behavior", "code": "44"}, {"row": 46, "name": "1人で出たがる", "group": "", "formula": "=IF(F46=\"\",\"\",CHOOSE(F46,0, 5, 5.4, 6.1, 7  ))", "optCount": 5, "cat": "behavior", "code": "45"}, {"row": 47, "name": "収集癖", "group": "", "formula": "=IF(F47=\"\",\"\",CHOOSE(F47,0, 3.8, 4.1, 4.5, 5.7  ))", "optCount": 5, "cat": "behavior", "code": "46"}, {"row": 48, "name": "物や衣類を壊す", "group": "", "formula": "=IF(F48=\"\",\"\",CHOOSE(F48,0, 4.3, 5, 5.8, 7.1  ))", "optCount": 5, "cat": "behavior", "code": "47"}, {"row": 49, "name": "不潔行為", "group": "", "formula": "=IF(F49=\"\",\"\",CHOOSE(F49,0, 4.9, 5.5, 5.5, 6.6  ))", "optCount": 5, "cat": "behavior", "code": "48"}, {"row": 50, "name": "異食行動", "group": "", "formula": "=IF(F50=\"\",\"\",CHOOSE(F50,0, 5.1, 5.1, 6.1, 6.2  ))", "optCount": 5, "cat": "behavior", "code": "49"}, {"row": 51, "name": "ひどい物忘れ", "group": "", "formula": "=IF(F51=\"\",\"\",CHOOSE(F51,0,0.6, 0.7, 1, 2.1  ))", "optCount": 5, "cat": "behavior", "code": "50"}, {"row": 52, "name": "集団への不適応", "group": "=SUM(E35:E52)", "formula": "=IF(F52=\"\",\"\",CHOOSE(F52,0, 3.1, 3.4, 4.8, 5.6  ))", "optCount": 5, "cat": "behavior", "code": "51"}, {"row": 53, "name": "こだわり", "group": "行動上の障害　B群", "formula": "=IF(F53=\"\",\"\",CHOOSE(F53,0, 1.9, 2.6, 3.6, 6.2   ))", "optCount": 5, "cat": "behavior", "code": "52"}, {"row": 54, "name": "多動・行動停止", "group": "", "formula": "=IF(F54=\"\",\"\",CHOOSE(F54,0, 3.2, 3.5, 5.6, 9.1  ))", "optCount": 5, "cat": "behavior", "code": "53"}, {"row": 55, "name": "不安定な行動", "group": "", "formula": "=IF(F55=\"\",\"\",CHOOSE(F55,0, 2.3, 3.5, 6.3, 10  ))", "optCount": 5, "cat": "behavior", "code": "54"}, {"row": 56, "name": "自らを傷つける", "group": "", "formula": "=IF(F56=\"\",\"\",CHOOSE(F56,0, 3.5, 4.9, 6.9, 9.2  ))", "optCount": 5, "cat": "behavior", "code": "55"}, {"row": 57, "name": "他人を傷つける", "group": "", "formula": "=IF(F57=\"\",\"\",CHOOSE(F57,0, 3.5, 4.6, 7.2, 11  ))", "optCount": 5, "cat": "behavior", "code": "56"}, {"row": 58, "name": "不適切な行為", "group": "", "formula": "=IF(F58=\"\",\"\",CHOOSE(F58,0, 4.4, 5.5, 6.7, 9.9  ))", "optCount": 5, "cat": "behavior", "code": "57"}, {"row": 59, "name": "突発的な行動", "group": "", "formula": "=IF(F59=\"\",\"\",CHOOSE(F59,0, 5.5, 8.3, 10.7, 12.7  ))", "optCount": 5, "cat": "behavior", "code": "58"}, {"row": 60, "name": "過食・反すう等", "group": "", "formula": "=IF(F60=\"\",\"\",CHOOSE(F60,0, 4.2, 4.5, 4.9, 7  ))", "optCount": 5, "cat": "behavior", "code": "59"}, {"row": 61, "name": "多飲水・過飲水", "group": "", "formula": "=IF(F61=\"\",\"\",CHOOSE(F61,0, 3.6, 4.4, 6.8, 9.1  ))", "optCount": 5, "cat": "behavior", "code": "60"}, {"row": 62, "name": "反復的行動", "group": "", "formula": "=IF(F62=\"\",\"\",CHOOSE(F62,0, 3.4, 4, 4.1, 6.7  ))", "optCount": 5, "cat": "behavior", "code": "61"}, {"row": 63, "name": "感覚過敏・鈍麻", "group": "=SUM(E53:E63)", "formula": "=IF(F63=\"\",\"\",CHOOSE(F63,0, 9.1  ))", "optCount": 2, "cat": "behavior", "code": "62"}, {"row": 64, "name": "躁うつ状態", "group": "行動上の障害　C群", "formula": "=IF(F64=\"\",\"\",CHOOSE(F64,0, 12.3, 14.2, 15.2, 19.1  ))", "optCount": 5, "cat": "behavior", "code": "63"}, {"row": 65, "name": "対人不安緊張", "group": "", "formula": "=IF(F65=\"\",\"\",CHOOSE(F65,0, 17.3, 19, 19.6, 20.8  ))", "optCount": 5, "cat": "behavior", "code": "64"}, {"row": 66, "name": "意欲が乏しい", "group": "", "formula": "=IF(F66=\"\",\"\",CHOOSE(F66,0, 15.3, 15.7, 15.9, 16.2  ))", "optCount": 5, "cat": "behavior", "code": "65"}, {"row": 67, "name": "話がまとまらない", "group": "", "formula": "=IF(F67=\"\",\"\",CHOOSE(F67,0, 13.4, 13.4, 13.5, 13.5  ))", "optCount": 5, "cat": "behavior", "code": "66"}, {"row": 68, "name": "集中力が続かない", "group": "", "formula": "=IF(F68=\"\",\"\",CHOOSE(F68,0, 13.6, 13.6, 13.6, 13.6  ))", "optCount": 5, "cat": "behavior", "code": "67"}, {"row": 69, "name": "自己の過大評価", "group": "=SUM(E64:E69)", "formula": "=IF(F69=\"\",\"\",CHOOSE(F69,0, 13.8, 13.9, 15.3, 16.8  ))", "optCount": 5, "cat": "behavior", "code": "68"}, {"row": 70, "name": "点滴の管理", "group": "特別な医療", "formula": "=IF(F70=\"\",\"\",CHOOSE(F70,0, 5.8 ))", "optCount": 2, "cat": "medical", "code": "69"}, {"row": 71, "name": "中心静脈栄養", "group": "", "formula": "=IF(F71=\"\",\"\",CHOOSE(F71,0, 16.1 ))", "optCount": 2, "cat": "medical", "code": "70"}, {"row": 72, "name": "透析", "group": "", "formula": "=IF(F72=\"\",\"\",CHOOSE(F72,0, 0.2 ))", "optCount": 2, "cat": "medical", "code": "71"}, {"row": 73, "name": "ストーマの管理", "group": "", "formula": "=IF(F73=\"\",\"\",CHOOSE(F73,0, 1.7 ))", "optCount": 2, "cat": "medical", "code": "72"}, {"row": 74, "name": "酸素療法", "group": "", "formula": "=IF(F74=\"\",\"\",CHOOSE(F74,0, 10.2  ))", "optCount": 2, "cat": "medical", "code": "73"}, {"row": 75, "name": "レスピレーター", "group": "", "formula": "=IF(F75=\"\",\"\",CHOOSE(F75,0, 16.9  ))", "optCount": 2, "cat": "medical", "code": "74"}, {"row": 76, "name": "気管切開の処置", "group": "", "formula": "=IF(F76=\"\",\"\",CHOOSE(F76,0, 14.9 ))", "optCount": 2, "cat": "medical", "code": "75"}, {"row": 77, "name": "疼痛の看護", "group": "", "formula": "=IF(F77=\"\",\"\",CHOOSE(F77,0, 1.2 ))", "optCount": 2, "cat": "medical", "code": "76"}, {"row": 78, "name": "経管栄養", "group": "", "formula": "=IF(F78=\"\",\"\",CHOOSE(F78,0, 8.6 ))", "optCount": 2, "cat": "medical", "code": "77"}, {"row": 79, "name": "モニター測定", "group": "", "formula": "=IF(F79=\"\",\"\",CHOOSE(F79,0, 15.9 ))", "optCount": 2, "cat": "medical", "code": "78"}, {"row": 80, "name": "じょくそうの処置", "group": "", "formula": "=IF(F80=\"\",\"\",CHOOSE(F80,0,3.7  ))", "optCount": 2, "cat": "medical", "code": "79"}, {"row": 81, "name": "カテーテル", "group": "=SUM(E70:E81)", "formula": "=IF(F81=\"\",\"\",CHOOSE(F81,0, 4.8  ))", "optCount": 2, "cat": "medical", "code": "80"}];
const EXTRAS = [{"row": 82, "name": "麻痺", "group": "麻痺・拘縮", "formula": "=IF(F82=\"\",\"\",CHOOSE(F82,0, 2.9, 4.9, 8.2, 13.9  ))", "optCount": 5, "cat": "extra", "code": ""}, {"row": 83, "name": "拘縮　肩関節", "group": "", "formula": "=IF(F83=\"\",\"\",CHOOSE(F83,0, 18.6  ))", "optCount": 2, "cat": "extra", "code": ""}, {"row": 84, "name": "拘縮　肘関節", "group": "", "formula": "=IF(F84=\"\",\"\",CHOOSE(F84,0, 19.6  ))", "optCount": 2, "cat": "extra", "code": ""}, {"row": 85, "name": "拘縮　股関節", "group": "", "formula": "=IF(F85=\"\",\"\",CHOOSE(F85,0, 18 ))", "optCount": 2, "cat": "extra", "code": ""}, {"row": 86, "name": "拘縮　膝関節", "group": "", "formula": "=IF(F86=\"\",\"\",CHOOSE(F86,0, 17.2  ))", "optCount": 2, "cat": "extra", "code": ""}, {"row": 87, "name": "拘縮　その他", "group": "=SUM(E82:E87)", "formula": "=IF(F87=\"\",\"\",CHOOSE(F87,0, 12.7 ))", "optCount": 2, "cat": "extra", "code": ""}, {"row": 88, "name": "麻痺　左上肢", "group": "その他の医師意見書項目", "formula": "=IF(F88=\"\",\"\",CHOOSE(F88,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 89, "name": "麻痺　右上肢", "group": "", "formula": "=IF(F89=\"\",\"\",CHOOSE(F89,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 90, "name": "麻痺　左下肢", "group": "", "formula": "=IF(F90=\"\",\"\",CHOOSE(F90,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 91, "name": "麻痺　右下肢", "group": "", "formula": "=IF(F91=\"\",\"\",CHOOSE(F91,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 92, "name": "麻痺　その他", "group": "", "formula": "=IF(F92=\"\",\"\",CHOOSE(F92,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 93, "name": "拘縮　肩　左", "group": "", "formula": "=IF(F93=\"\",\"\",CHOOSE(F93,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 94, "name": "拘縮　肩　右", "group": "", "formula": "=IF(F94=\"\",\"\",CHOOSE(F94,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 95, "name": "拘縮　股　左", "group": "", "formula": "=IF(F95=\"\",\"\",CHOOSE(F95,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 96, "name": "拘縮　股　右", "group": "", "formula": "=IF(F96=\"\",\"\",CHOOSE(F96,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 97, "name": "拘縮　肘　左", "group": "", "formula": "=IF(F97=\"\",\"\",CHOOSE(F97,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 98, "name": "拘縮　肘　右", "group": "", "formula": "=IF(F98=\"\",\"\",CHOOSE(F98,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 99, "name": "拘縮　膝　左", "group": "", "formula": "=IF(F99=\"\",\"\",CHOOSE(F99,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 100, "name": "拘縮　膝　右", "group": "", "formula": "=IF(F100=\"\",\"\",CHOOSE(F100,0, 2,3,4 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 101, "name": "てんかん", "group": "", "formula": "=IF(F101=\"\",\"\",CHOOSE(F101,0,1, 1.5, 2 ))", "optCount": 4, "cat": "extra", "code": ""}, {"row": 102, "name": "二軸　精神症状", "group": "", "formula": "=IF(F102=\"\",\"\",CHOOSE(F102,0, 2,3,4,5,6 ))", "optCount": 6, "cat": "extra", "code": ""}, {"row": 103, "name": "二軸　能力障害", "group": "", "formula": "=IF(F103=\"\",\"\",CHOOSE(F103,0, 2,3,4,5 ))", "optCount": 5, "cat": "extra", "code": ""}];
const RULES = [{"k": 0, "n": 1, "p": 0.622, "conds": ["生活機能2<=23.5", "応用日常=0", "行動A=0", "行動C=0", "金銭=0", "感情=0", "麻痺<=2.9"]}, {"k": 0, "n": 2, "p": 0.824, "conds": ["応用日常=0", "行動A=0", "行動B=0", "特別医療=0", "片足立位=0", "集中力=0", "拘縮肩=0", "生活食事=0"]}, {"k": 1, "n": 3, "p": 0.64, "conds": ["生活機能2=0", "応用日常<=36.1", "行動A>=0.1", "行動B=0", "感情=0", "麻痺<=2.9"]}, {"k": 1, "n": 4, "p": 0.804, "conds": ["生活機能2<=23.5", "応用日常<=13", "行動A=0", "金銭>=1.4", "感情=0", "麻痺<=2.9", "二軸能力>=2"]}, {"k": 1, "n": 5, "p": 0.661, "conds": ["生活機能2=0", "応用日常<=36.1", "行動A>=0.1", "行動B>=0.1", "感情=0", "麻痺<=2.9", "二軸能力<=2"]}, {"k": 1, "n": 6, "p": 0.613, "conds": ["生活機能2<=23.5", "応用日常<=13", "行動A=0", "金銭>=1.4", "感情=0", "麻痺<=2.9", "二軸能力<=3"]}, {"k": 1, "n": 7, "p": 0.611, "conds": ["生活機能2<=23.5", "応用日常<=13", "行動A=0", "行動C>=0.1", "金銭=0", "感情=0", "麻痺<=2.9"]}, {"k": 1, "n": 8, "p": 0.509, "conds": ["起居動作>=0.1", "生活機能2<=23.5", "応用日常>=13.1", "応用日常<=36.1", "行動A=0", "感情=0", "麻痺<=2.9"]}, {"k": 1, "n": 9, "p": 0.626, "conds": ["起居動作=0", "生活機能1<=15.5", "生活機能2=0", "応用日常>=36.2", "応用日常<=73.2", "行動A<=20.1", "行動C<=12.4", "感情=0"]}, {"k": 1, "n": 10, "p": 0.5, "conds": ["起居動作=0", "生活機能2<=23.5", "応用日常>=13.1", "応用日常<=36.1", "行動A=0", "行動C>=23.7", "感情=0", "麻痺<=2.9"]}, {"k": 1, "n": 11, "p": 0.474, "conds": ["生活機能2=0", "応用日常<=36.1", "行動A>=0.1", "行動B>=0.1", "感情=0", "意欲=0", "麻痺<=2.9", "二軸能力>=3"]}, {"k": 1, "n": 12, "p": 0.421, "conds": ["生活機能2<=23.5", "応用日常>=0.1", "応用日常<=13", "行動A=0", "行動C=0", "金銭=0", "感情=0", "麻痺<=2.9"]}, {"k": 1, "n": 13, "p": 0.64, "conds": ["起居動作=0", "生活機能2<=23.5", "応用日常>=13.1", "応用日常<=36.1", "行動A=0", "行動C<=23.6", "感情=0", "麻痺<=2.9", "生活金銭>=4"]}, {"k": 1, "n": 14, "p": 0.591, "conds": ["生活機能2>=0.1", "生活機能2<=23.5", "応用日常<=36.1", "認知<=10.7", "行動A>=0.1", "行動A<=14.1", "行動C<=14", "感情=0", "麻痺<=2.9"]}, {"k": 1, "n": 15, "p": 0.927, "conds": ["起居動作=0", "生活機能2<=23.5", "応用日常>=13.1", "応用日常<=36.1", "行動A=0", "行動C<=23.6", "意思決定>=9.1", "感情=0", "麻痺<=2.9", "生活金銭<=3"]}, {"k": 1, "n": 16, "p": 0.889, "conds": ["起居動作=0", "生活機能2<=6.7", "応用日常>=13.1", "応用日常<=36.1", "行動A=0", "行動C<=23.6", "意思決定=0", "買い物>=7.9", "感情=0", "麻痺<=2.9", "生活金銭<=3"]}, {"k": 1, "n": 17, "p": 0.741, "conds": ["起居動作=0", "生活機能2<=6.7", "応用日常>=13.1", "応用日常<=36.1", "行動A=0", "行動C<=23.6", "意思決定=0", "買い物=0", "感情=0", "麻痺<=2.9", "生活金銭<=3"]}, {"k": 1, "n": 18, "p": 0.723, "conds": ["起居動作=0", "生活機能2>=6.8", "生活機能2<=23.5", "応用日常>=13.1", "応用日常<=36.1", "行動A=0", "行動C<=23.6", "意思決定=0", "感情=0", "麻痺<=2.9", "生活金銭<=3"]}, {"k": 1, "n": 19, "p": 0.889, "conds": ["生活機能2=0", "行動A=0", "特別医療=0", "洗濯=7", "生活金銭=3"]}, {"k": 1, "n": 20, "p": 0.966, "conds": ["生活機能2=0", "行動A=0", "金銭=1.4", "二軸能力=2", "生活対人=2"]}, {"k": 1, "n": 21, "p": 0.844, "conds": ["入浴=0", "感情=0", "二軸能力=2", "生活リズム=0", "生活服薬=2"]}, {"k": 1, "n": 22, "p": 0.829, "conds": ["生活機能2=0", "調理=9.4", "感情=0", "二軸能力=2", "生活リズム=0"]}, {"k": 1, "n": 23, "p": 0.87, "conds": ["生活機能2=0", "認知>=0.1", "認知<=13.1", "行動A=0", "金銭=1.4", "二軸能力=2"]}, {"k": 1, "n": 24, "p": 0.941, "conds": ["応用日常>=0.1", "応用日常<=32.9", "行動A=0", "洗濯=7", "生活食事=3", "生活保清=3"]}, {"k": 1, "n": 25, "p": 0.875, "conds": ["視聴覚=0", "掃除=0", "感情=0", "集中力=0", "二軸能力=2", "生活金銭=3"]}, {"k": 1, "n": 26, "p": 0.857, "conds": ["視聴覚=0", "掃除=0", "感情=0", "物忘れ=0", "二軸能力=2", "生活金銭=3"]}, {"k": 1, "n": 27, "p": 0.906, "conds": ["応用日常>=0.1", "応用日常<=32.9", "行動A=0", "洗濯=7", "二軸能力=3", "生活金銭=3"]}, {"k": 1, "n": 28, "p": 0.75, "conds": ["生活機能2<=23.5", "応用日常=0", "行動A=0", "行動C=0", "片足立位>=2.8", "片足立位<=3.4", "金銭=0", "感情=0", "麻痺<=2.9"]}, {"k": 2, "n": 29, "p": 0.685, "conds": ["生活機能2=0", "応用日常>=36.2", "応用日常<=73.2", "行動A>=20.2", "行動A<=32.7"]}, {"k": 2, "n": 30, "p": 0.67, "conds": ["生活機能2<=10.6", "応用日常<=36.1", "麻痺拘縮<=8.7", "感情=0", "麻痺>=4.9"]}, {"k": 2, "n": 31, "p": 0.616, "conds": ["生活機能2<=23.5", "応用日常<=36.1", "行動A>=21", "調理=0", "感情>=2.1"]}, {"k": 2, "n": 32, "p": 0.605, "conds": ["起居動作<=6.8", "生活機能1<=4", "生活機能2<=23.5", "応用日常>=73.3", "行動A<=16.7"]}, {"k": 2, "n": 33, "p": 0.53, "conds": ["生活機能2>=10.7", "生活機能2<=23.5", "応用日常<=36.1", "感情=0", "麻痺>=4.9"]}, {"k": 2, "n": 34, "p": 0.909, "conds": ["生活機能2<=10.6", "応用日常<=36.1", "麻痺拘縮>=8.8", "感情=0", "麻痺>=4.9", "麻痺右下=0"]}, {"k": 2, "n": 35, "p": 0.909, "conds": ["生活機能2<=10.6", "応用日常<=36.1", "麻痺拘縮>=8.8", "感情=0", "麻痺>=4.9", "麻痺左下=0"]}, {"k": 2, "n": 36, "p": 0.8, "conds": ["生活機能2<=10.6", "応用日常<=36.1", "麻痺拘縮>=8.8", "感情=0", "麻痺>=4.9", "麻痺右下>=2"]}, {"k": 2, "n": 37, "p": 0.8, "conds": ["生活機能2<=10.6", "応用日常<=36.1", "麻痺拘縮>=8.8", "感情=0", "麻痺>=4.9", "麻痺左下>=2"]}, {"k": 2, "n": 38, "p": 0.745, "conds": ["生活機能1<=15.5", "生活機能2=0", "応用日常>=36.2", "応用日常<=73.2", "行動A<=20.1", "感情>=2.1"]}, {"k": 2, "n": 39, "p": 0.744, "conds": ["生活機能2<=23.5", "応用日常<=36.1", "認知>=0.1", "行動A<=20.9", "行動C<=38.6", "感情>=2.1"]}, {"k": 2, "n": 40, "p": 0.722, "conds": ["生活機能2<=23.5", "応用日常<=36.1", "認知=0", "行動A<=20.9", "感情>=2.1", "昼夜逆転>=2.1"]}, {"k": 2, "n": 41, "p": 0.59, "conds": ["生活機能1>=15.6", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A<=20.1", "麻痺拘縮<=7.1"]}, {"k": 2, "n": 42, "p": 0.569, "conds": ["生活機能2<=23.5", "応用日常<=36.1", "認知>=0.1", "行動A<=20.9", "行動C>=38.7", "感情>=2.1"]}, {"k": 2, "n": 43, "p": 0.481, "conds": ["生活機能2<=23.5", "応用日常<=36.1", "認知=0", "行動A<=20.9", "感情>=2.1", "昼夜逆転=0"]}, {"k": 2, "n": 44, "p": 0.422, "conds": ["生活機能2>=0.1", "生活機能2<=23.5", "応用日常<=36.1", "行動A>=14.2", "感情=0", "麻痺<=2.9"]}, {"k": 2, "n": 45, "p": 0.804, "conds": ["起居動作>=0.1", "生活機能1<=15.5", "生活機能2=0", "応用日常>=36.2", "応用日常<=73.2", "行動A<=20.1", "感情=0", "1", "1", "1", "1", "1"]}, {"k": 2, "n": 46, "p": 0.538, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A<=8.4", "行動C>=38.7", "1", "1", "1", "1", "1"]}, {"k": 2, "n": 47, "p": 0.741, "conds": ["生活機能1=0", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A<=20.1", "行動C<=38.6", "片足立位>=11.4", "1", "1", "1", "1"]}, {"k": 2, "n": 48, "p": 0.684, "conds": ["生活機能2=0", "応用日常<=36.1", "行動A>=0.1", "行動B>=0.1", "感情=0", "意欲>=15.3", "麻痺<=2.9", "二軸能力>=3", "1", "1", "1", "1"]}, {"k": 2, "n": 49, "p": 0.679, "conds": ["起居動作=0", "生活機能1<=15.5", "生活機能2=0", "応用日常>=42.8", "応用日常<=73.2", "行動A<=20.1", "行動C>=12.5", "感情=0", "1", "1", "1", "1"]}, {"k": 2, "n": 50, "p": 0.589, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=32.7", "応用日常<=73.2", "認知>=20.6", "行動A<=32.7", "移乗=0", "暴言暴行=0", "1", "1", "1", "1"]}, {"k": 2, "n": 51, "p": 0.58, "conds": ["生活機能2>=0.1", "生活機能2<=23.5", "応用日常<=36.1", "行動A>=0.1", "行動A<=14.1", "行動C>=14.1", "感情=0", "麻痺<=2.9", "1", "1", "1", "1"]}, {"k": 2, "n": 52, "p": 0.569, "conds": ["起居動作=0", "生活機能1<=15.5", "生活機能2=0", "応用日常>=36.2", "応用日常<=42.7", "行動A<=20.1", "行動C>=12.5", "感情=0", "1", "1", "1", "1"]}, {"k": 2, "n": 53, "p": 0.554, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A>=8.5", "行動A<=20.1", "行動C>=38.7", "1", "1", "1", "1"]}, {"k": 2, "n": 54, "p": 0.522, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常<=73.2", "認知<=20.5", "行動A<=32.7", "移乗=0", "片足立位>=2.8", "1", "1", "1", "1"]}, {"k": 2, "n": 55, "p": 0.435, "conds": ["生活機能2>=0.1", "生活機能2<=23.5", "応用日常<=36.1", "認知>=10.8", "行動A>=0.1", "行動A<=14.1", "行動C<=14", "感情=0", "麻痺<=2.9", "1", "1", "1"]}, {"k": 2, "n": 56, "p": 0.743, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常<=73.2", "認知<=20.5", "行動A<=32.7", "移乗=0", "片足立位=0", "こだわり=0", "1", "1", "1"]}, {"k": 2, "n": 57, "p": 0.523, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常<=73.2", "認知<=20.5", "行動A<=32.7", "移乗=0", "片足立位=0", "こだわり>=1.9", "1", "1", "1"]}, {"k": 2, "n": 58, "p": 0.485, "conds": ["生活機能1>=0.1", "生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A<=20.1", "行動C<=38.6", "片足立位>=11.4", "1", "1", "1"]}, {"k": 2, "n": 59, "p": 0.778, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=51.6", "認知>=19", "行動A<=20.1", "行動C<=38.6", "片足立位<=3.4", "生活対人<=3", "1", "1"]}, {"k": 2, "n": 60, "p": 0.705, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=51.7", "応用日常<=73.2", "認知>=19", "行動A<=20.1", "行動C<=38.6", "片足立位<=3.4", "生活対人<=3", "1", "1"]}, {"k": 2, "n": 61, "p": 0.672, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "認知<=18.9", "行動A<=20.1", "行動C<=38.6", "移乗>=6.6", "片足立位<=3.4", "1", "1"]}, {"k": 2, "n": 62, "p": 0.525, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "認知>=19", "行動A<=20.1", "行動C<=38.6", "片足立位<=3.4", "生活対人>=4", "1", "1"]}, {"k": 2, "n": 63, "p": 0.959, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "認知<=18.9", "行動A<=20.1", "行動C=0", "麻痺拘縮>=0.1", "移乗=0", "片足立位<=3.4", "1"]}, {"k": 2, "n": 64, "p": 0.81, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "認知<=18.9", "行動A>=1.6", "行動A<=20.1", "行動C<=38.6", "麻痺拘縮=0", "移乗=0", "片足立位<=3.4"]}, {"k": 2, "n": 65, "p": 0.754, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "認知<=18.9", "行動A<=20.1", "行動C>=0.1", "行動C<=38.6", "麻痺拘縮>=0.1", "移乗=0", "片足立位<=3.4"]}, {"k": 2, "n": 66, "p": 0.724, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "認知<=18.9", "行動A<=1.5", "行動C<=38.6", "麻痺拘縮=0", "移乗=0", "片足立位<=3.4", "口腔清潔>=6.9"]}, {"k": 2, "n": 67, "p": 0.491, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "認知<=18.9", "行動A<=1.5", "行動C<=38.6", "麻痺拘縮=0", "移乗=0", "片足立位<=3.4", "口腔清潔=0"]}, {"k": 2, "n": 68, "p": 0.8, "conds": ["入浴=0", "交通手段=0", "麻痺右上=3"]}, {"k": 2, "n": 69, "p": 0.8, "conds": ["入浴=0", "交通手段=0", "麻痺左上=3"]}, {"k": 2, "n": 70, "p": 0.848, "conds": ["生活機能1=0", "入浴=0", "透析=0.2"]}, {"k": 2, "n": 71, "p": 0.909, "conds": ["起き上がり=0", "交通手段=0", "透析=0.2"]}, {"k": 2, "n": 72, "p": 0.809, "conds": ["生活機能1=0", "特別医療>=0.1", "特別医療<=3.7", "入浴=0", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 2, "n": 73, "p": 0.881, "conds": ["生活機能2>=0.1", "生活機能2<=19.5", "視聴覚>=10.7", "視聴覚<=41.1", "応用日常>=33", "応用日常<=61.5", "交通手段=18.9", "1", "1", "1", "1", "1"]}, {"k": 2, "n": 74, "p": 0.882, "conds": ["交通手段=0", "透析=0.2", "拘縮肩=0", "拘縮股=0", "拘縮肘=0", "拘縮膝=0", "拘縮他=0", "1", "1", "1", "1", "1"]}, {"k": 2, "n": 75, "p": 0.5, "conds": ["生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A>=20.2", "行動A<=32.7", "金銭=0", "1", "1", "1", "1", "1"]}, {"k": 2, "n": 76, "p": 0.556, "conds": ["生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A>=20.2", "行動A<=32.7", "買い物=0", "1", "1", "1", "1", "1"]}, {"k": 2, "n": 77, "p": 0.825, "conds": ["生活機能2>=0.1", "生活機能2<=19.5", "応用日常>=33", "応用日常<=61.5", "認知>=0.1", "認知<=13.1", "視力>=25.5", "視力<=28.3", "1", "1", "1", "1"]}, {"k": 2, "n": 78, "p": 0.607, "conds": ["起居動作=0", "生活機能1>=21.1", "生活機能2>=23.6", "生活機能2<=34.8", "応用日常<=69.4", "行動A<=30.2", "行動C<=24.7", "移乗<=6.6", "1", "1", "1", "1"]}, {"k": 2, "n": 79, "p": 0.5, "conds": ["生活機能2=0", "応用日常<=36.1", "行動A>=0.1", "行動B>=0.1", "被害拒否=2.1", "感情=0", "意欲=0", "麻痺<=2.9", "二軸能力>=3", "1", "1", "1"]}, {"k": 2, "n": 80, "p": 0.571, "conds": ["生活機能2=0", "応用日常<=36.1", "行動A>=0.1", "行動B>=0.1", "感情=0", "反復=6.7", "意欲=0", "麻痺<=2.9", "二軸能力>=3", "1", "1", "1"]}, {"k": 2, "n": 81, "p": 0.519, "conds": ["生活機能2=0", "応用日常<=36.1", "行動A>=0.1", "行動B>=0.1", "感情=0", "意欲=0", "麻痺<=2.9", "二軸能力>=3", "生活金銭=2", "1", "1", "1"]}, {"k": 2, "n": 82, "p": 0.526, "conds": ["生活機能2=0", "応用日常<=36.1", "行動A>=0.1", "行動B>=0.1", "感情=0", "支援の拒否=2.8", "意欲=0", "麻痺<=2.9", "二軸能力>=3", "1", "1", "1"]}, {"k": 2, "n": 83, "p": 0.8, "conds": ["生活機能2>=0.1", "生活機能2<=23.5", "応用日常<=36.1", "認知<=10.7", "行動A>=0.1", "行動A<=14.1", "行動C<=14", "感情=0", "麻痺<=2.9", "生活金銭=3", "1", "1"]}, {"k": 2, "n": 84, "p": 1.0, "conds": ["生活機能2>=0.1", "生活機能2<=23.5", "応用日常<=36.1", "認知<=10.7", "行動A>=0.1", "行動A<=14.1", "行動C<=14", "被害拒否=1.9", "感情=0", "麻痺<=2.9", "1", "1"]}, {"k": 2, "n": 85, "p": 0.6, "conds": ["生活機能2>=0.1", "生活機能2<=23.5", "応用日常<=36.1", "認知<=10.7", "行動A>=0.1", "行動A<=14.1", "行動C<=14", "感情=0", "麻痺<=2.9", "生活服薬=4", "1", "1"]}, {"k": 3, "n": 86, "p": 0.769, "conds": ["起居動作>=6.9", "生活機能2<=23.5", "応用日常>=73.3", "行動A<=16.7", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 87, "p": 0.563, "conds": ["生活機能2<=23.5", "応用日常>=73.3", "行動A>=16.8", "不安定な行動<=2.3", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 88, "p": 0.697, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=34.8", "応用日常<=73.2", "移乗>=6.6", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 89, "p": 0.597, "conds": ["起居動作<=6.8", "生活機能1>=4.1", "生活機能2<=23.5", "応用日常>=73.3", "行動A<=16.7", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 90, "p": 0.585, "conds": ["生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A>=32.8", "そううつ>=12.3", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 91, "p": 0.47, "conds": ["生活機能1<=21", "生活機能2>=34.9", "生活機能2<=50.6", "応用日常<=73.2", "移乗>=6.6", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 92, "p": 0.461, "conds": ["生活機能2<=23.5", "応用日常<=36.1", "行動A>=21", "調理>=9.4", "感情>=2.1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 93, "p": 0.343, "conds": ["生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A>=32.8", "そううつ=0", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 94, "p": 0.573, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常>=73.3", "行動A<=14.1", "排尿>=11.6", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 95, "p": 0.528, "conds": ["生活機能1>=15.6", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A<=20.1", "麻痺拘縮>=7.2", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 96, "p": 0.5, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常>=73.3", "行動A>=23.2", "生活社会=0", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 97, "p": 0.455, "conds": ["生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A>=20.2", "行動A<=32.7", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 98, "p": 0.419, "conds": ["生活機能1>=21.1", "生活機能2>=34.9", "生活機能2<=50.6", "応用日常<=69.4", "行動A<=30.2", "移乗<=6.6", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 99, "p": 0.938, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常>=73.3", "行動A<=3", "麻痺拘縮>=8.8", "排尿=0", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 100, "p": 0.806, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常>=73.3", "行動A<=3", "麻痺拘縮<=8.7", "排尿=0", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 101, "p": 0.722, "conds": ["生活機能1>=21.1", "生活機能2>=23.6", "生活機能2<=34.8", "応用日常<=69.4", "行動A<=30.2", "行動C>=24.8", "移乗<=6.6", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 102, "p": 0.677, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常>=73.3", "行動A>=3.1", "行動A<=14.1", "排尿=0", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 103, "p": 0.603, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常>=73.3", "行動A>=14.2", "行動A<=23.1", "生活社会=0", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 104, "p": 0.525, "conds": ["生活機能1>=21.1", "生活機能2>=23.6", "生活機能2<=34.8", "応用日常<=69.4", "行動A<=30.2", "行動C<=24.7", "移乗<=6.6", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 105, "p": 0.491, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常<=73.2", "認知<=23.9", "行動A>=32.8", "移乗=0", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 106, "p": 0.625, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常<=73.2", "認知>=20.6", "行動A<=32.7", "移乗=0", "暴言暴行>=2.6", "1", "1", "1", "1"]}, {"k": 3, "n": 107, "p": 0.516, "conds": ["生活機能1<=21", "生活機能2>=32.8", "生活機能2<=50.6", "応用日常<=73.2", "認知>=20.6", "行動A<=32.7", "移乗=0", "暴言暴行=0", "1", "1", "1", "1"]}, {"k": 3, "n": 108, "p": 0.727, "conds": ["生活機能1>=21.1", "生活機能1<=35.7", "生活機能2>=23.6", "生活機能2<=41.1", "応用日常>=69.5", "行動A<=30.2", "行動B<=26.4", "移乗<=6.6", "口腔清潔>=6.9", "1", "1", "1"]}, {"k": 3, "n": 109, "p": 0.566, "conds": ["生活機能1>=21.1", "生活機能1<=35.7", "生活機能2>=23.6", "生活機能2<=41.1", "応用日常>=69.5", "行動A<=30.2", "行動B<=26.4", "移乗<=6.6", "口腔清潔=0", "1", "1", "1"]}, {"k": 3, "n": 110, "p": 0.455, "conds": ["排尿=0", "こだわり=2.6", "てんかん>=1", "1", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 111, "p": 0.44, "conds": ["排便=0", "こだわり=2.6", "てんかん>=1", "1", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 112, "p": 0.875, "conds": ["起居動作>=26.7", "起居動作<=62", "行動B=0", "移動=5.8", "排便=10.9", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 113, "p": 0.811, "conds": ["起居動作>=26.7", "起居動作<=62", "行動B=0", "排便=10.9", "麻痺左下>=2", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 114, "p": 0.811, "conds": ["起居動作>=26.7", "起居動作<=62", "行動B=0", "排便=10.9", "麻痺右下>=2", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 115, "p": 0.804, "conds": ["起居動作>=26.7", "起居動作<=62", "行動B=0", "排便=10.9", "拘縮他=0", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 116, "p": 0.909, "conds": ["生活機能1>=0.1", "生活機能1<=22.4", "移乗=6.6", "薬=0", "麻痺=8.2", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 117, "p": 0.853, "conds": ["生活機能1>=0.1", "生活機能1<=22.4", "移乗=6.6", "調理=20.2", "麻痺=8.2", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 118, "p": 0.871, "conds": ["生活機能1>=0.1", "生活機能1<=22.4", "認知=0", "移乗=6.6", "入浴=6.1", "拘縮肩右=0", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 119, "p": 0.871, "conds": ["生活機能1>=0.1", "生活機能1<=22.4", "認知=0", "移乗=6.6", "入浴=6.1", "拘縮肩左=0", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 120, "p": 0.9, "conds": ["生活機能1>=0.1", "生活機能1<=22.4", "寝返り>=7.8", "寝返り<=10.4", "移乗=6.6", "調理=9.4", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 121, "p": 0.75, "conds": ["起居動作<=6.8", "生活機能1<=4", "生活機能2<=23.5", "応用日常>=73.3", "行動A<=16.7", "移乗=6.6", "1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 122, "p": 0.83, "conds": ["生活機能1>=0.1", "生活機能1<=22.4", "寝返り>=7.8", "寝返り<=10.4", "移乗=6.6", "片足立位>=2.8", "片足立位<=3.4", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 123, "p": 0.82, "conds": ["生活機能1>=0.1", "生活機能1<=22.4", "行動A>=0.1", "行動A<=7.1", "寝返り>=7.8", "寝返り<=10.4", "移乗=6.6", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 124, "p": 1.0, "conds": ["生活機能2<=23.5", "応用日常<=36.1", "認知>=0.1", "行動A<=20.9", "行動C<=38.6", "衣類の着脱=12", "感情>=2.1", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 125, "p": 1.0, "conds": ["生活機能2<=23.5", "応用日常<=36.1", "認知>=0.1", "行動A<=20.9", "行動C<=38.6", "感情>=2.1", "集団への不適応>=5.6", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 126, "p": 0.667, "conds": ["生活機能2>=0.1", "生活機能2<=23.5", "応用日常<=36.1", "行動A>=14.2", "感情=0", "多飲水過飲水>=4.4", "麻痺<=2.9", "1", "1", "1", "1", "1"]}, {"k": 3, "n": 127, "p": 0.833, "conds": ["生活機能2>=0.1", "生活機能2<=23.5", "応用日常<=36.1", "行動A>=14.2", "感情=0", "落ち着き>=4.4", "落ち着き<=5", "麻痺<=2.9", "1", "1", "1", "1"]}, {"k": 3, "n": 128, "p": 0.571, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A<=8.4", "行動C>=38.7", "拘縮他=12.7", "1", "1", "1", "1"]}, {"k": 3, "n": 129, "p": 0.625, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A<=8.4", "行動C>=38.7", "移乗=6.6", "1", "1", "1", "1"]}, {"k": 3, "n": 130, "p": 0.538, "conds": ["生活機能1>=21.1", "生活機能1<=35.7", "生活機能2>=41.2", "生活機能2<=50.6", "応用日常>=69.5", "行動A<=30.2", "行動B<=26.4", "移乗=0", "1", "1", "1", "1"]}, {"k": 3, "n": 131, "p": 1.0, "conds": ["生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A<=8.4", "行動C>=38.7", "落ち着き>=4.4", "落ち着き<=5", "1", "1", "1"]}, {"k": 3, "n": 132, "p": 0.556, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常<=73.2", "認知<=20.5", "行動A<=32.7", "移乗=0", "片足立位>=2.8", "衣類の着脱=12", "1", "1", "1"]}, {"k": 3, "n": 133, "p": 0.533, "conds": ["生活機能1>=0.1", "生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A<=20.1", "行動C<=38.6", "片足立位>=11.4", "拘縮他=12.7", "1", "1"]}, {"k": 3, "n": 134, "p": 0.571, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常<=73.2", "認知<=20.5", "行動A<=32.7", "移乗=0", "片足立位>=2.8", "支援の拒否>=2.8", "支援の拒否<=3.4", "1", "1"]}, {"k": 3, "n": 135, "p": 0.75, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=32.7", "応用日常<=73.2", "認知>=20.6", "行動A<=32.7", "移乗=0", "暴言暴行=0", "落ち着き>=4.4", "落ち着き<=5", "1", "1"]}, {"k": 3, "n": 136, "p": 0.75, "conds": ["生活機能1>=0.1", "生活機能1<=15.5", "生活機能2>=0.1", "生活機能2<=23.5", "応用日常>=36.2", "応用日常<=73.2", "行動A<=20.1", "行動C<=38.6", "片足立位>=11.4", "支援の拒否>=2.8", "支援の拒否<=3.4", "1"]}, {"k": 3, "n": 137, "p": 0.75, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常<=73.2", "認知<=20.5", "行動A<=32.7", "移乗=0", "片足立位=0", "落ち着き>=4.4", "落ち着き<=5", "こだわり>=1.9", "1"]}, {"k": 4, "n": 138, "p": 0.565, "conds": ["生活機能2<=23.5", "応用日常>=73.3", "行動A>=16.8", "不安定な行動>=3.5", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 139, "p": 0.509, "conds": ["生活機能1<=37.5", "生活機能2>=50.7", "生活機能2<=74", "行動A<=45.1", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 140, "p": 0.528, "conds": ["生活機能1>=21.1", "生活機能1<=40.3", "生活機能2>=23.6", "生活機能2<=50.6", "行動A>=30.3", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 141, "p": 0.465, "conds": ["生活機能1>=40.4", "生活機能2>=23.6", "生活機能2<=50.6", "行動A>=30.3", "調理<=9.4", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 142, "p": 0.626, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常>=73.3", "行動A>=14.2", "生活社会>=2", "1", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 143, "p": 0.613, "conds": ["生活機能1>=35.8", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常>=69.5", "行動A<=30.2", "移乗<=6.6", "1", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 144, "p": 0.55, "conds": ["生活機能1>=21.1", "生活機能1<=34.5", "生活機能2>=23.6", "生活機能2<=50.6", "行動A<=30.2", "移乗>=10.7", "1", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 145, "p": 0.5, "conds": ["生活機能1<=21", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常<=73.2", "認知>=24", "行動A>=32.8", "移乗=0", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 146, "p": 0.554, "conds": ["生活機能1>=21.1", "生活機能1<=35.7", "生活機能2>=23.6", "生活機能2<=50.6", "応用日常>=69.5", "行動A<=30.2", "行動B>=26.5", "移乗<=6.6", "1", "1", "1", "1"]}, {"k": 4, "n": 147, "p": 0.534, "conds": ["生活機能1>=37.6", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=74", "行動A<=40.2", "移乗<=6.6", "麻痺<=4.9", "生活社会<=3", "1", "1", "1", "1"]}, {"k": 4, "n": 148, "p": 0.524, "conds": ["生活機能1>=21.1", "生活機能1<=35.7", "生活機能2>=41.2", "生活機能2<=50.6", "応用日常>=69.5", "行動A<=30.2", "行動B<=26.4", "移乗<=6.6", "1", "1", "1", "1"]}, {"k": 4, "n": 149, "p": 0.806, "conds": ["生活機能2>=19.6", "生活機能2<=42.6", "ひとりで出たがる=0", "反復>=4.1", "自己の過大評価=0", "生活社会=5", "1", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 150, "p": 0.667, "conds": ["生活機能1>=34.6", "生活機能2>=23.6", "生活機能2<=50.6", "行動A<=30.2", "移乗>=10.7", "衣類の着脱=0", "1", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 151, "p": 0.609, "conds": ["生活機能1>=34.6", "生活機能2>=23.6", "生活機能2<=50.6", "行動A<=30.2", "移乗>=10.7", "入浴<=6.1", "1", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 152, "p": 1.0, "conds": ["生活機能2<=23.5", "応用日常<=36.1", "行動A>=21", "調理>=9.4", "感情>=2.1", "二軸能力=5", "1", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 153, "p": 0.806, "conds": ["生活機能2>=19.6", "生活機能2<=42.6", "認知>=43.8", "認知<=85.4", "反復>=4.1", "自己の過大評価=0", "生活社会=5", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 154, "p": 0.6, "conds": ["生活機能1>=21.1", "生活機能2>=34.9", "生活機能2<=50.6", "応用日常<=69.4", "行動A<=30.2", "移乗<=6.6", "生活リズム>=4", "1", "1", "1", "1", "1"]}, {"k": 4, "n": 155, "p": 0.6, "conds": ["生活機能1>=37.6", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=64.2", "行動A>=40.3", "移乗<=6.6", "衣類の着脱=0", "生活社会<=3", "1", "1", "1", "1"]}, {"k": 4, "n": 156, "p": 0.75, "conds": ["生活機能1>=37.6", "生活機能1<=42", "生活機能2>=50.7", "生活機能2<=74", "応用日常>=33", "応用日常<=61.5", "行動A<=36.6", "移乗>=10.7", "1", "1", "1", "1"]}, {"k": 5, "n": 157, "p": 0.598, "conds": ["生活機能1<=37.5", "生活機能2>=50.7", "生活機能2<=74", "行動A>=45.2", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 158, "p": 0.561, "conds": ["生活機能1>=60", "生活機能2>=50.7", "生活機能2<=70.9", "食事<=14.4", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 159, "p": 0.667, "conds": ["生活機能1<=42", "生活機能2>=78.2", "行動A<=44.4", "食事<=14.4", "他人を傷つける=0", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 160, "p": 0.517, "conds": ["生活機能1>=34.6", "生活機能2>=23.6", "生活機能2<=50.6", "行動A<=30.2", "移乗>=10.7", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 161, "p": 0.476, "conds": ["生活機能1>=40.4", "生活機能2>=23.6", "生活機能2<=50.6", "行動A>=30.3", "調理>=20.2", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 162, "p": 0.464, "conds": ["生活機能1<=59.9", "生活機能2>=78.2", "行動A<=44.4", "食事<=14.4", "他人を傷つける>=3.5", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 163, "p": 0.741, "conds": ["生活機能1>=60", "生活機能2>=71", "行動A<=50.6", "移乗<=6.6", "食事<=14.4", "不安定な行動<=3.5", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 164, "p": 0.421, "conds": ["生活機能1<=59.9", "生活機能2>=74.1", "生活機能2<=78.1", "行動A<=44.4", "移乗<=6.6", "食事<=14.4", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 165, "p": 0.698, "conds": ["生活機能1<=59.9", "生活機能2>=74.1", "生活機能2<=78.1", "行動A<=44.4", "移乗>=10.7", "食事<=14.4", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 166, "p": 0.597, "conds": ["生活機能1>=42.1", "生活機能1<=59.9", "生活機能2>=88.1", "行動A<=44.4", "食事<=14.4", "他人を傷つける=0", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 167, "p": 0.556, "conds": ["生活機能1>=37.6", "生活機能1<=42", "生活機能2>=50.7", "生活機能2<=74", "行動A<=36.6", "移乗>=10.7", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 168, "p": 0.485, "conds": ["生活機能1>=37.6", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=74", "行動A>=36.7", "移乗>=10.7", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 169, "p": 0.763, "conds": ["生活機能1>=42.1", "生活機能1<=59.9", "生活機能2>=78.2", "生活機能2<=88", "行動A<=44.4", "食事<=14.4", "他人を傷つける=0", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 170, "p": 0.699, "conds": ["生活機能1>=37.6", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=74", "行動B<=59.2", "移乗<=6.6", "生活社会>=4", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 171, "p": 0.651, "conds": ["生活機能1>=37.6", "生活機能1<=59.9", "生活機能2>=64.3", "生活機能2<=74", "行動A>=40.3", "移乗<=6.6", "生活社会<=3", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 172, "p": 0.636, "conds": ["生活機能1>=42.1", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=74", "行動A<=36.6", "移乗>=10.7", "食事>=23.9", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 173, "p": 0.474, "conds": ["生活機能1>=37.6", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=64.2", "行動A>=40.3", "移乗<=6.6", "生活社会<=3", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 174, "p": 0.865, "conds": ["生活機能1>=42.1", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=74", "行動A<=36.6", "移乗>=10.7", "食事<=14.4", "拘縮膝>=17.2", "1", "1", "1", "1"]}, {"k": 5, "n": 175, "p": 0.667, "conds": ["生活機能1>=42.1", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=74", "行動A<=36.6", "移乗>=10.7", "食事<=14.4", "拘縮膝=0", "1", "1", "1", "1"]}, {"k": 5, "n": 176, "p": 0.604, "conds": ["生活機能1>=37.6", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=74", "認知<=65.7", "行動B>=59.3", "移乗<=6.6", "生活社会>=4", "1", "1", "1", "1"]}, {"k": 5, "n": 177, "p": 0.55, "conds": ["生活機能1>=37.6", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=74", "行動A<=40.2", "移乗<=6.6", "麻痺>=8.2", "生活社会<=3", "1", "1", "1", "1"]}, {"k": 5, "n": 178, "p": 0.477, "conds": ["生活機能1>=37.6", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=74", "認知>=65.8", "行動B>=59.3", "移乗<=6.6", "生活社会>=4", "1", "1", "1", "1"]}, {"k": 5, "n": 179, "p": 0.818, "conds": ["生活機能1>=40.1", "生活機能1<=61.1", "そううつ>=15.2", "麻痺左下=4", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 180, "p": 0.818, "conds": ["生活機能1>=40.1", "生活機能1<=61.1", "そううつ>=15.2", "麻痺右下=4", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 181, "p": 0.903, "conds": ["生活機能1>=40.1", "生活機能1<=61.1", "麻痺その他>=2", "拘縮股=18", "二軸能力=3", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 182, "p": 0.882, "conds": ["生活機能1>=40.1", "生活機能1<=61.1", "交通手段=18.9", "拘縮股=18", "二軸能力=3", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 183, "p": 0.865, "conds": ["生活機能2>=42.7", "生活機能2<=69.2", "起き上がり=15", "移乗=10.7", "買い物=19.5", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 184, "p": 0.824, "conds": ["生活機能2>=42.7", "生活機能2<=69.2", "起き上がり=15", "移乗=10.7", "麻痺右下>=2", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 185, "p": 0.824, "conds": ["生活機能2>=42.7", "生活機能2<=69.2", "起き上がり=15", "移乗=10.7", "麻痺左下>=2", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 186, "p": 0.8, "conds": ["生活機能2>=42.7", "生活機能2<=69.2", "起き上がり=15", "移乗=10.7", "排尿=20.1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 187, "p": 1.0, "conds": ["生活機能1>=60", "生活機能2>=71", "行動A<=50.6", "移乗<=6.6", "食事<=14.4", "掃除=6.7", "不安定な行動<=3.5", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 188, "p": 0.641, "conds": ["生活機能1>=60", "生活機能2>=71", "行動A<=50.6", "麻痺拘縮=0", "移乗<=6.6", "食事<=14.4", "不安定な行動<=3.5", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 189, "p": 0.9, "conds": ["生活機能1>=60", "生活機能2>=71", "行動A<=50.6", "移乗<=6.6", "食事<=14.4", "薬=3.3", "不安定な行動<=3.5", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 190, "p": 0.833, "conds": ["生活機能1>=60", "生活機能2>=71", "行動A<=50.6", "移乗<=6.6", "食事<=14.4", "説明の理解=0", "不安定な行動<=3.5", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 191, "p": 0.717, "conds": ["生活機能1>=60", "生活機能2>=71", "行動A<=50.6", "移乗<=6.6", "食事<=14.4", "不安定な行動<=3.5", "自らを傷つける=0", "1", "1", "1", "1", "1"]}, {"k": 5, "n": 192, "p": 0.6, "conds": ["生活機能1>=37.6", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=74", "行動A<=40.2", "移乗<=6.6", "食事=23.9", "麻痺<=4.9", "生活社会<=3", "1", "1", "1"]}, {"k": 5, "n": 193, "p": 0.65, "conds": ["生活機能1>=37.6", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2<=74", "行動A<=40.2", "行動B>=48.1", "移乗<=6.6", "麻痺<=4.9", "生活社会<=3", "1", "1", "1"]}, {"k": 6, "n": 194, "p": 0.968, "conds": ["生活機能1>=60", "生活機能2>=50.7", "食事>=23.9", "1", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 6, "n": 195, "p": 0.546, "conds": ["食事>=23.9", "生活機能1<=59.9", "生活機能2>=74.1", "1", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 6, "n": 196, "p": 0.84, "conds": ["食事<=14.4", "生活機能1 >= 60", "生活機能2>=71", "行動A>=50.7", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 6, "n": 197, "p": 0.591, "conds": ["食事<=14.4", "生活機能1<=59.9", "生活機能2>=74.1", "行動A>=44.5", "1", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 6, "n": 198, "p": 0.687, "conds": ["生活機能1 >= 60", "生活機能2>=71", "行動A<=50.6", "移乗>=10.7", "食事<=14.4", "1", "1", "1", "1", "1", "1", "1"]}, {"k": 6, "n": 199, "p": 0.531, "conds": ["生活機能1 >= 60", "生活機能2>=71", "行動A<=50.6", "移乗<=6.6", "食事<=14.4", "不安定な行動>=6.3", "1", "1", "1", "1", "1", "1"]}, {"k": 6, "n": 200, "p": 0.985, "conds": ["食事=23.9", "二軸精神=4"]}, {"k": 6, "n": 201, "p": 1.0, "conds": ["食事=23.9", "ひとりで出たがる >=6.1"]}, {"k": 6, "n": 202, "p": 0.98, "conds": ["食事=23.9", "拘縮他=12.7"]}, {"k": 6, "n": 203, "p": 0.985, "conds": ["食事=23.9", "視力 =2.8"]}, {"k": 6, "n": 204, "p": 1.0, "conds": ["食事=23.9", "大声奇声=6"]}, {"k": 6, "n": 205, "p": 0.98, "conds": ["食事=23.9", "拘縮股左 =2"]}, {"k": 6, "n": 206, "p": 0.98, "conds": ["食事=23.9", "拘縮股右=2"]}, {"k": 6, "n": 207, "p": 0.992, "conds": ["認知>=85.5", "特別医療>=10.3"]}, {"k": 6, "n": 208, "p": 1.0, "conds": ["説明の理解=15.3", "気管切開の処置=14.9"]}, {"k": 6, "n": 209, "p": 1.0, "conds": ["気管切開の処置=14.9", "麻痺左上=4"]}, {"k": 6, "n": 210, "p": 1.0, "conds": ["気管切開の処置=14.9", "麻痺右上=4"]}, {"k": 6, "n": 211, "p": 1.0, "conds": ["生活機能1>=61.2", "レスピレーター=16.9"]}, {"k": 6, "n": 212, "p": 0.95, "conds": ["座位保持=15.9", "衣類の着脱=18.2", "てんかん>=1"]}, {"k": 6, "n": 213, "p": 0.95, "conds": ["座位保持=15.9", "移乗=15.9", "てんかん>=1"]}, {"k": 6, "n": 214, "p": 0.987, "conds": ["食事=23.9", "視力 >=25.5", "視力 <=28.3"]}, {"k": 6, "n": 215, "p": 0.857, "conds": ["生活機能2>=69.3", "てんかん>=1", "生活リズム=5"]}, {"k": 6, "n": 216, "p": 1.0, "conds": ["生活機能1>=37.6", "生活機能1<=59.9", "生活機能2>=50.7", "生活機能2 <=74", "行動A<=40.2", "移乗<=6.6", "衣類の着脱=0", "麻痺>=8.2", "生活社会<=3"]}];
const DEFINED = {"こだわり": "E53", "じょくそう": "E9", "じょくそうの処置": "E80", "そううつ": "E64", "てんかん": "E101", "ひとりで出たがる": "E46", "カテーテル": "E81", "コミュニケーション": "E33", "ストーマの管理": "E73", "モニター測定": "E79", "レスピレーター": "E75", "不安定な行動": "E55", "不潔行為": "E49", "不適切な行為": "E58", "両足立位": "E5", "中心静脈栄養": "E71", "二軸精神": "E102", "二軸能力": "E103", "交通手段": "E26", "他人を傷つける": "E57", "作話": "E36", "健康栄養": "E19", "入浴": "E16", "危険の認識": "E32", "反復": "E62", "収集癖": "E47", "口腔清潔": "E17", "同じ話": "E40", "嚥下": "E10", "外出して戻れない": "E45", "多動行動停止": "E54", "多飲水過飲水": "E61", "大声奇声": "E41", "寝返り": "E2", "対人不安緊張": "E65", "座位保持": "E4", "徘徊": "E43", "応用日常": "B26", "意思決定": "E30", "意欲": "E66", "感情": "E37", "感覚過敏鈍麻": "E63", "拘縮他": "E87", "拘縮肘": "E84", "拘縮肘右": "E98", "拘縮肘左": "E97", "拘縮股": "E85", "拘縮股右": "E96", "拘縮股左": "E95", "拘縮肩": "E83", "拘縮肩右": "E94", "拘縮肩左": "E93", "拘縮膝": "E86", "拘縮膝右": "E100", "拘縮膝左": "E99", "掃除": "E23", "排便": "E13", "排尿": "E12", "支援の拒否": "E42", "昼夜逆転": "E38", "暴言暴行": "E39", "歩行": "E6", "気管切開の処置": "E76", "洗濯": "E24", "点滴の管理": "E70", "片足立位": "E8", "物や衣類を壊す": "E48", "物忘れ": "E51", "特別医療": "B81", "生活リズム": "E105", "生活保清": "E106", "生活対人": "E109", "生活服薬": "E108", "生活機能1": "B13", "生活機能2": "B19", "生活社会": "E110", "生活金銭": "E107", "生活食事": "E104", "異食行動": "E50", "疼痛の看護": "E77", "移乗": "E14", "移動": "E15", "突発的な行動": "E59", "立ち上がり": "E7", "経管栄養": "E78", "聴力": "E21", "自らを傷つける": "E56", "自己の過大評価": "E69", "落ち着き": "E44", "薬": "E27", "行動A": "B52", "行動B": "B63", "行動C": "B69", "衣類の着脱": "E18", "被害拒否": "E35", "視力": "E20", "視聴覚": "B21", "話がまとまらない": "E67", "認知": "B34", "説明の理解": "E34", "読み書き": "E31", "調理": "E22", "買い物": "E25", "起き上がり": "E3", "起居動作": "B8", "透析": "E72", "過食反すう": "E60", "酸素療法": "E74", "金銭": "E28", "集中力": "E68", "集団への不適応": "E52", "電話等": "E29", "食事": "E11", "麻痺": "E82", "麻痺その他": "E92", "麻痺右上": "E89", "麻痺右下": "E91", "麻痺左上": "E88", "麻痺左下": "E90", "麻痺拘縮": "B87"};
const FORMULAS = {"E2": "=IF(F2=\"\",\"\",CHOOSE(F2,0,7.8,10.4,14.8))", "E3": "=IF(F3=\"\",\"\",CHOOSE(F3,0,6.2,8.9,15))", "E4": "=IF(F4=\"\",\"\",CHOOSE(F4,0,6.8,11.6,15.9))", "E5": "=IF(F5=\"\",\"\",CHOOSE(F5,0,7.2,9.4,14.5))", "E6": "=IF(F6=\"\",\"\",CHOOSE(F6,0,5.4,7.7,13.6))", "E7": "=IF(F7=\"\",\"\",CHOOSE(F7,0,5.1,7.7,14.8))", "B8": "=SUM(E2:E8)", "E8": "=IF(F8=\"\",\"\",CHOOSE(F8,0,2.8,3.4,11.4))", "E9": "=IF(F9=\"\",\"\",CHOOSE(F9,0,10.9))", "E10": "=IF(F10=\"\",\"\",CHOOSE(F10,0,13.5,25.2))", "E11": "=IF(F11=\"\",\"\",CHOOSE(F11,0,14.4,23.9))", "E12": "=IF(F12=\"\",\"\",CHOOSE(F12,0,11.6,20.1))", "B13": "=SUM(E9:E13)", "E13": "=IF(F13=\"\",\"\",CHOOSE(F13,0,10.9,19.9))", "E14": "=IF(F14=\"\",\"\",CHOOSE(F14,0,6.6,10.7,15.9))", "E15": "=IF(F15=\"\",\"\",CHOOSE(F15,0,5.8,10.8,17.1))", "E16": "=IF(F16=\"\",\"\",CHOOSE(F16,0,6.1, 16.2))", "E17": "=IF(F17=\"\",\"\",CHOOSE(F17,0,6.9, 15.9))", "E18": "=IF(F18=\"\",\"\",CHOOSE(F18,0 ,6.9,12,18.2))", "B19": "=SUM(E14:E19)", "E19": "=IF(F19=\"\",\"\",CHOOSE(F19,0,9.3,16.7))", "E20": "=IF(F20=\"\",\"\",CHOOSE(F20,0,2.8,7.3,25.5,28.3,48.9))", "B21": "=SUM(E20:E21)", "E21": "=IF(F21=\"\",\"\",CHOOSE(F21,0,6.4,9.1,9.1,9.1,51.1))", "E22": "=IF(F22=\"\",\"\",CHOOSE(F22,0 ,9.4,20.2))", "E23": "=IF(F23=\"\",\"\",CHOOSE(F23,0 ,6.7,20.9))", "E24": "=IF(F24=\"\",\"\",CHOOSE(F24,0 ,7 ,20.5))", "E25": "=IF(F25=\"\",\"\",CHOOSE(F25,0 ,7.9, 19.5))", "B26": "=SUM(E22:E26)", "E26": "=IF(F26=\"\",\"\",CHOOSE(F26,0 , 6.9, 18.9))", "E27": "=IF(F27=\"\",\"\",CHOOSE(F27,0 , 3.3, 11))", "E28": "=IF(F28=\"\",\"\",CHOOSE(F28,0 , 1.4, 9.5))", "E29": "=IF(F29=\"\",\"\",CHOOSE(F29,0 , 2.6, 10.7))", "E30": "=IF(F30=\"\",\"\",CHOOSE(F30,0 , 9.1, 15.6))", "E31": "=IF(F31=\"\",\"\",CHOOSE(F31,0 , 4.1, 11.7))", "E32": "=IF(F32=\"\",\"\",CHOOSE(F32,0 , 4.1, 11.7))", "E33": "=IF(F33=\"\",\"\",CHOOSE(F33,0 , 4.1, 5.5, 11, 14.5))", "B34": "=SUM(E27:E34)", "E34": "=IF(F34=\"\",\"\",CHOOSE(F34,0 , 15.3, 15.3))", "E35": "=IF(F35=\"\",\"\",CHOOSE(F35,0 , 1.9, 2.1, 3.3, 4.6))", "E36": "=IF(F36=\"\",\"\",CHOOSE(F36,0 , 2.1, 2.1, 3.9, 5.3))", "E37": "=IF(F37=\"\",\"\",CHOOSE(F37,0 , 2.1, 2.6, 3.7, 5.4))", "E38": "=IF(F38=\"\",\"\",CHOOSE(F38,0 ,2.1,2.9,3.5,3.5 ))", "E39": "=IF(F39=\"\",\"\",CHOOSE(F39,0 ,2.6,3, 4.4, 6.2 ))", "E40": "=IF(F40=\"\",\"\",CHOOSE(F40,0 ,2.1, 2.4, 3.3, 4.8 ))", "E41": "=IF(F41=\"\",\"\",CHOOSE(F41,0, 2.7, 3, 4.1, 6  ))", "E42": "=IF(F42=\"\",\"\",CHOOSE(F42,0 , 2.8, 3.4, 4.3, 5.9 ))", "E43": "=IF(F43=\"\",\"\",CHOOSE(F43,0, 3.7, 3.8, 4.4, 6  ))", "E44": "=IF(F44=\"\",\"\",CHOOSE(F44,0 ,4.4, 5, 5.5, 7 ))", "E45": "=IF(F45=\"\",\"\",CHOOSE(F45,0 ,3.3, 4.3, 4.3, 5  ))", "E46": "=IF(F46=\"\",\"\",CHOOSE(F46,0, 5, 5.4, 6.1, 7  ))", "E47": "=IF(F47=\"\",\"\",CHOOSE(F47,0, 3.8, 4.1, 4.5, 5.7  ))", "E48": "=IF(F48=\"\",\"\",CHOOSE(F48,0, 4.3, 5, 5.8, 7.1  ))", "E49": "=IF(F49=\"\",\"\",CHOOSE(F49,0, 4.9, 5.5, 5.5, 6.6  ))", "E50": "=IF(F50=\"\",\"\",CHOOSE(F50,0, 5.1, 5.1, 6.1, 6.2  ))", "E51": "=IF(F51=\"\",\"\",CHOOSE(F51,0,0.6, 0.7, 1, 2.1  ))", "B52": "=SUM(E35:E52)", "E52": "=IF(F52=\"\",\"\",CHOOSE(F52,0, 3.1, 3.4, 4.8, 5.6  ))", "E53": "=IF(F53=\"\",\"\",CHOOSE(F53,0, 1.9, 2.6, 3.6, 6.2   ))", "E54": "=IF(F54=\"\",\"\",CHOOSE(F54,0, 3.2, 3.5, 5.6, 9.1  ))", "E55": "=IF(F55=\"\",\"\",CHOOSE(F55,0, 2.3, 3.5, 6.3, 10  ))", "E56": "=IF(F56=\"\",\"\",CHOOSE(F56,0, 3.5, 4.9, 6.9, 9.2  ))", "E57": "=IF(F57=\"\",\"\",CHOOSE(F57,0, 3.5, 4.6, 7.2, 11  ))", "E58": "=IF(F58=\"\",\"\",CHOOSE(F58,0, 4.4, 5.5, 6.7, 9.9  ))", "E59": "=IF(F59=\"\",\"\",CHOOSE(F59,0, 5.5, 8.3, 10.7, 12.7  ))", "E60": "=IF(F60=\"\",\"\",CHOOSE(F60,0, 4.2, 4.5, 4.9, 7  ))", "E61": "=IF(F61=\"\",\"\",CHOOSE(F61,0, 3.6, 4.4, 6.8, 9.1  ))", "E62": "=IF(F62=\"\",\"\",CHOOSE(F62,0, 3.4, 4, 4.1, 6.7  ))", "B63": "=SUM(E53:E63)", "E63": "=IF(F63=\"\",\"\",CHOOSE(F63,0, 9.1  ))", "E64": "=IF(F64=\"\",\"\",CHOOSE(F64,0, 12.3, 14.2, 15.2, 19.1  ))", "E65": "=IF(F65=\"\",\"\",CHOOSE(F65,0, 17.3, 19, 19.6, 20.8  ))", "E66": "=IF(F66=\"\",\"\",CHOOSE(F66,0, 15.3, 15.7, 15.9, 16.2  ))", "E67": "=IF(F67=\"\",\"\",CHOOSE(F67,0, 13.4, 13.4, 13.5, 13.5  ))", "E68": "=IF(F68=\"\",\"\",CHOOSE(F68,0, 13.6, 13.6, 13.6, 13.6  ))", "B69": "=SUM(E64:E69)", "E69": "=IF(F69=\"\",\"\",CHOOSE(F69,0, 13.8, 13.9, 15.3, 16.8  ))", "E70": "=IF(F70=\"\",\"\",CHOOSE(F70,0, 5.8 ))", "E71": "=IF(F71=\"\",\"\",CHOOSE(F71,0, 16.1 ))", "E72": "=IF(F72=\"\",\"\",CHOOSE(F72,0, 0.2 ))", "E73": "=IF(F73=\"\",\"\",CHOOSE(F73,0, 1.7 ))", "E74": "=IF(F74=\"\",\"\",CHOOSE(F74,0, 10.2  ))", "E75": "=IF(F75=\"\",\"\",CHOOSE(F75,0, 16.9  ))", "E76": "=IF(F76=\"\",\"\",CHOOSE(F76,0, 14.9 ))", "E77": "=IF(F77=\"\",\"\",CHOOSE(F77,0, 1.2 ))", "E78": "=IF(F78=\"\",\"\",CHOOSE(F78,0, 8.6 ))", "E79": "=IF(F79=\"\",\"\",CHOOSE(F79,0, 15.9 ))", "E80": "=IF(F80=\"\",\"\",CHOOSE(F80,0,3.7  ))", "B81": "=SUM(E70:E81)", "E81": "=IF(F81=\"\",\"\",CHOOSE(F81,0, 4.8  ))", "E82": "=IF(F82=\"\",\"\",CHOOSE(F82,0, 2.9, 4.9, 8.2, 13.9  ))", "E83": "=IF(F83=\"\",\"\",CHOOSE(F83,0, 18.6  ))", "E84": "=IF(F84=\"\",\"\",CHOOSE(F84,0, 19.6  ))", "E85": "=IF(F85=\"\",\"\",CHOOSE(F85,0, 18 ))", "E86": "=IF(F86=\"\",\"\",CHOOSE(F86,0, 17.2  ))", "B87": "=SUM(E82:E87)", "E87": "=IF(F87=\"\",\"\",CHOOSE(F87,0, 12.7 ))", "E88": "=IF(F88=\"\",\"\",CHOOSE(F88,0, 2,3,4 ))", "E89": "=IF(F89=\"\",\"\",CHOOSE(F89,0, 2,3,4 ))", "E90": "=IF(F90=\"\",\"\",CHOOSE(F90,0, 2,3,4 ))", "E91": "=IF(F91=\"\",\"\",CHOOSE(F91,0, 2,3,4 ))", "E92": "=IF(F92=\"\",\"\",CHOOSE(F92,0, 2,3,4 ))", "E93": "=IF(F93=\"\",\"\",CHOOSE(F93,0, 2,3,4 ))", "E94": "=IF(F94=\"\",\"\",CHOOSE(F94,0, 2,3,4 ))", "E95": "=IF(F95=\"\",\"\",CHOOSE(F95,0, 2,3,4 ))", "E96": "=IF(F96=\"\",\"\",CHOOSE(F96,0, 2,3,4 ))", "E97": "=IF(F97=\"\",\"\",CHOOSE(F97,0, 2,3,4 ))", "E98": "=IF(F98=\"\",\"\",CHOOSE(F98,0, 2,3,4 ))", "E99": "=IF(F99=\"\",\"\",CHOOSE(F99,0, 2,3,4 ))", "E100": "=IF(F100=\"\",\"\",CHOOSE(F100,0, 2,3,4 ))", "E101": "=IF(F101=\"\",\"\",CHOOSE(F101,0,1, 1.5, 2 ))", "E102": "=IF(F102=\"\",\"\",CHOOSE(F102,0, 2,3,4,5,6 ))", "E103": "=IF(F103=\"\",\"\",CHOOSE(F103,0, 2,3,4,5 ))", "E104": "=IF(F104=\"\",\"\",CHOOSE(F104,0, 2,3,4,5 ))", "E105": "=IF(F105=\"\",\"\",CHOOSE(F105,0, 2,3,4,5 ))", "E106": "=IF(F106=\"\",\"\",CHOOSE(F106,0, 2,3,4,5 ))", "E107": "=IF(F107=\"\",\"\",CHOOSE(F107,0, 2,3,4,5 ))", "E108": "=IF(F108=\"\",\"\",CHOOSE(F108,0, 2,3,4,5 ))", "E109": "=IF(F109=\"\",\"\",CHOOSE(F109,0, 2,3,4,5 ))", "E110": "=IF(F110=\"\",\"\",CHOOSE(F110,0, 2,3,4,5 ))"};
const VALUES = {"C1": "項目", "D1": "略称", "E1": "点数", "F1": "選択番号\n入力", "G1": "メ\nモ", "H1": "区分判定", "A2": 1, "B2": "起居動作", "C2": "寝返り", "D2": "寝返り", "F2": 1, "H2": "１　支援が不要", "C3": "起き上がり", "D3": "起き上がり", "F3": 1, "H3": "１　支援が不要", "C4": "座位保持", "D4": "座位保持", "F4": 1, "H4": "１　支援が不要", "C5": "両足立位", "D5": "両足立位", "F5": 1, "H5": "１　支援が不要", "C6": "歩行", "D6": "歩行", "F6": 1, "H6": "１　支援が不要", "C7": "立ち上がり", "D7": "立ち上がり", "F7": 1, "H7": "１　支援が不要", "C8": "片足立位", "D8": "片足立位", "F8": 1, "H8": "１　支援が不要", "A9": 2, "B9": "生活機能 I", "C9": "じょくそう", "D9": "じょくそう", "F9": 1, "H9": "１　ない", "C10": "嚥下", "D10": "嚥下", "F10": 1, "H10": "１　支援が不要", "C11": "食事", "D11": "食事", "F11": 1, "H11": "１　支援が不要", "C12": "排尿", "D12": "排尿", "F12": 1, "H12": "１　支援が不要", "C13": "排便", "D13": "排便", "F13": 1, "H13": "１　支援が不要", "A14": 3, "B14": "生活機能 II", "C14": "移乗", "D14": "移乗", "F14": 1, "H14": "１　支援が不要", "C15": "移動", "D15": "移動", "F15": 1, "H15": "１　支援が不要", "C16": "入浴", "D16": "入浴", "F16": 1, "H16": "１　支援が不要", "C17": "口腔清潔", "D17": "口腔清潔", "F17": 1, "H17": "１　支援が不要", "C18": "衣類の着脱", "D18": "衣類の着脱", "F18": 1, "H18": "１　支援が不要", "C19": "健康・栄養管理", "D19": "健康栄養", "F19": 1, "H19": "１　支援が不要", "A20": 4, "B20": "視聴覚", "C20": "視力", "D20": "視力", "F20": 1, "H20": "１　支障がない ", "C21": "聴力", "D21": "聴力", "F21": 1, "H21": "１　支障がない ", "A22": 5, "B22": "応用日常生活動作", "C22": "調理", "D22": "調理", "F22": 1, "H22": "１　支援が不要", "C23": "掃除", "D23": "掃除", "F23": 1, "H23": "１　支援が不要", "C24": "洗濯", "D24": "洗濯", "F24": 1, "H24": "１　支援が不要", "C25": "買い物", "D25": "買い物", "F25": 1, "H25": "１　支援が不要", "C26": "交通手段", "D26": "交通手段", "F26": 1, "H26": "１　支援が不要", "A27": 6, "B27": "認知機能", "C27": "薬の管理", "D27": "薬", "F27": 1, "H27": "１　支援が不要", "C28": "金銭の管理", "D28": "金銭", "F28": 1, "H28": "１　支援が不要", "C29": "電話等", "D29": "電話等", "F29": 1, "H29": "１　支援が不要", "C30": "日常の意思決定", "D30": "意思決定", "F30": 1, "H30": "１　支援が不要", "C31": "読み書き", "D31": "読み書き", "F31": 1, "H31": "１　支援が不要", "C32": "危険の認識", "D32": "危険の認識", "F32": 1, "H32": "１　支援が不要", "C33": "コミュニケーション", "D33": "コミュニケーション", "F33": 1, "H33": "１　支障がない ", "C34": "説明の理解", "D34": "説明の理解", "F34": 1, "H34": "１　理解できる", "A35": 7, "B35": "行動上の障害　A群", "C35": "被害的・拒否的", "D35": "被害拒否", "F35": 1, "H35": "１　支援が不要", "C36": "作話", "D36": "作話", "F36": 1, "H36": "１　支援が不要", "C37": "感情が不安定", "D37": "感情が不安定", "F37": 1, "H37": "１　支援が不要", "C38": "昼夜逆転", "D38": "昼夜逆転", "F38": 1, "H38": "１　支援が不要", "C39": "暴言暴行", "D39": "暴言暴行", "F39": 1, "H39": "１　支援が不要", "C40": "同じ話をする", "D40": "同じ話", "F40": 1, "H40": "１　支援が不要", "C41": "大声・奇声を出す", "D41": "大声奇声", "F41": 1, "H41": "１　支援が不要", "C42": "支援の拒否", "D42": "支援の拒否", "F42": 1, "H42": "１　支援が不要", "C43": "徘徊", "D43": "徘徊", "F43": 1, "H43": "１　支援が不要", "C44": "落ち着きがない", "D44": "落ち着き", "F44": 1, "H44": "１　支援が不要", "C45": "外出して戻れない", "D45": "外出して戻れない", "F45": 1, "H45": "１　支援が不要", "C46": "1人で出たがる", "D46": "ひとりで出たがる", "F46": 1, "H46": "１　支援が不要", "C47": "収集癖", "D47": "収集癖", "F47": 1, "H47": "１　支援が不要", "C48": "物や衣類を壊す", "D48": "物や衣類を壊す", "F48": 1, "H48": "１　支援が不要", "C49": "不潔行為", "D49": "不潔行為", "F49": 1, "H49": "１　支援が不要", "C50": "異食行動", "D50": "異食行動", "F50": 1, "H50": "１　支援が不要", "C51": "ひどい物忘れ", "D51": "物忘れ", "F51": 1, "H51": "１　支援が不要", "C52": "集団への不適応", "D52": "集団への不適応", "F52": 1, "H52": "１　支援が不要", "A53": 8, "B53": "行動上の障害　B群", "C53": "こだわり", "D53": "こだわり", "F53": 1, "H53": "１　支援が不要", "C54": "多動・行動停止", "D54": "多動行動停止", "F54": 1, "H54": "１　支援が不要", "C55": "不安定な行動", "D55": "不安定な行動", "F55": 1, "H55": "１　支援が不要", "C56": "自らを傷つける", "D56": "自らを傷つける", "F56": 1, "H56": "１　支援が不要", "C57": "他人を傷つける", "D57": "他人を傷つける", "F57": 1, "H57": "１　支援が不要", "C58": "不適切な行為", "D58": "不適切な行為", "F58": 1, "H58": "１　支援が不要", "C59": "突発的な行動", "D59": "突発的な行動", "F59": 1, "H59": "１　支援が不要", "C60": "過食・反すう等", "D60": "過食反すう", "F60": 1, "H60": "１　支援が不要", "C61": "多飲水・過飲水", "D61": "多飲水過飲水", "F61": 1, "H61": "１　支援が不要", "C62": "反復的行動", "D62": "反復", "F62": 1, "H62": "１　支援が不要", "C63": "感覚過敏・鈍麻", "D63": "感覚過敏鈍麻", "F63": 1, "H63": "１　ない", "A64": 9, "B64": "行動上の障害　C群", "C64": "躁うつ状態", "D64": "そううつ", "F64": 1, "H64": "１　支援が不要", "C65": "対人不安緊張", "D65": "対人不安緊張", "F65": 1, "H65": "１　支援が不要", "C66": "意欲が乏しい", "D66": "意欲", "F66": 1, "H66": "１　支援が不要", "C67": "話がまとまらない", "D67": "話がまとまらない", "F67": 1, "H67": "１　支援が不要", "C68": "集中力が続かない", "D68": "集中力", "F68": 1, "H68": "１　支援が不要", "C69": "自己の過大評価", "D69": "自己の過大評価", "F69": 1, "H69": "１　支援が不要", "A70": 10, "B70": "特別な医療", "C70": "点滴の管理", "D70": "点滴の管理", "F70": 1, "H70": "１　ない", "C71": "中心静脈栄養", "D71": "中心静脈栄養", "F71": 1, "H71": "１　ない", "C72": "透析", "D72": "透析", "F72": 1, "H72": "１　ない", "C73": "ストーマの管理", "D73": "ストーマの管理", "F73": 1, "H73": "１　ない", "C74": "酸素療法", "D74": "酸素療法", "F74": 1, "H74": "１　ない", "C75": "レスピレーター", "D75": "レスピレーター", "F75": 1, "H75": "１　ない", "C76": "気管切開の処置", "D76": "気管切開の処置", "F76": 1, "H76": "１　ない", "C77": "疼痛の看護", "D77": "疼痛の看護", "F77": 1, "H77": "１　ない", "C78": "経管栄養", "D78": "経管栄養", "F78": 1, "H78": "１　ない", "C79": "モニター測定", "D79": "モニター測定", "F79": 1, "H79": "１　ない", "C80": "じょくそうの処置", "D80": "じょくそうの処置", "F80": 1, "H80": "１　ない", "C81": "カテーテル", "D81": "カテーテル", "F81": 1, "H81": "１　ない", "A82": 11, "B82": "麻痺・拘縮", "C82": "麻痺", "D82": "麻痺", "F82": 1, "H82": "１　ない", "C83": "拘縮　肩関節", "D83": "拘縮肩", "F83": 1, "H83": "１　ない", "C84": "拘縮　肘関節", "D84": "拘縮肘", "F84": 1, "H84": "１　ない", "C85": "拘縮　股関節", "D85": "拘縮股", "F85": 1, "H85": "１　ない", "C86": "拘縮　膝関節", "D86": "拘縮膝", "F86": 1, "H86": "１　ない", "C87": "拘縮　その他", "D87": "拘縮他", "F87": 1, "H87": "１　ない", "A88": 12, "B88": "その他の医師意見書項目", "C88": "麻痺　左上肢", "D88": "麻痺左上", "F88": 1, "H88": "１　ない", "C89": "麻痺　右上肢", "D89": "麻痺右上", "F89": 1, "H89": "１　ない", "C90": "麻痺　左下肢", "D90": "麻痺左下", "F90": 1, "H90": "１　ない", "C91": "麻痺　右下肢", "D91": "麻痺右下", "F91": 1, "H91": "１　ない", "C92": "麻痺　その他", "D92": "麻痺その他", "F92": 1, "H92": "１　ない", "C93": "拘縮　肩　左", "D93": "拘縮肩左", "F93": 1, "H93": "１　ない", "C94": "拘縮　肩　右", "D94": "拘縮肩右", "F94": 1, "H94": "１　ない", "C95": "拘縮　股　左", "D95": "拘縮股左", "F95": 1, "H95": "１　ない", "C96": "拘縮　股　右", "D96": "拘縮股右", "F96": 1, "H96": "１　ない", "C97": "拘縮　肘　左", "D97": "拘縮肘左", "F97": 1, "H97": "１　ない", "C98": "拘縮　肘　右", "D98": "拘縮肘右", "F98": 1, "H98": "１　ない", "C99": "拘縮　膝　左", "D99": "拘縮膝左", "F99": 1, "H99": "１　ない", "C100": "拘縮　膝　右", "D100": "拘縮膝右", "F100": 1, "H100": "１　ない", "C101": "てんかん", "D101": "てんかん", "F101": 1, "H101": "１　ない", "C102": "二軸　精神症状", "D102": "二軸精神", "F102": 1, "H102": 1, "C103": "二軸　能力障害", "D103": "二軸能力", "F103": 1, "H103": 1, "C104": "生活　食事", "D104": "生活食事", "F104": 1, "H104": 1, "C105": "生活　生活リズム", "D105": "生活リズム", "F105": 1, "H105": 1, "C106": "生活　保清", "D106": "生活保清", "F106": 1, "H106": 1, "C107": "生活　金銭管理", "D107": "生活金銭", "F107": 1, "H107": 1, "C108": "生活　服薬管理", "D108": "生活服薬", "F108": 1, "H108": 1, "C109": "生活　対人関係", "D109": "生活対人", "F109": 1, "H109": 1, "C110": "生活　社会適応", "D110": "生活社会", "F110": 1, "H110": 1};

const LS_KEY = "yatagarasu015_interview_v1";
const $ = (id)=>document.getElementById(id);

function nowDateStr(){
  const d=new Date(); const mm=String(d.getMonth()+1).padStart(2,"0"); const dd=String(d.getDate()).padStart(2,"0");
  return `${d.getFullYear()}-${mm}-${dd}`;
}
$("date").value = nowDateStr();

const LABELS = {
  physical: [
    ["1","1．支援が不要"],
    ["2","2．見守り等の支援が必要"],
    ["3","3．部分的な支援が必要"],
    ["4","4．全面的な支援が必要"],
  ],
  daily: [
    ["1","1．支援が不要"],
    ["2","2．部分的な支援が必要"],
    ["3","3．全面的な支援が必要"],
  ],
  behavior: [
    ["1","1．支援が不要"],
    ["2","2．稀に支援が必要"],
    ["3","3．月に1回以上の支援が必要"],
    ["4","4．週に1回以上の支援が必要"],
    ["5","5．ほぼ毎日（週に5日以上）の支援が必要"],
  ],
  comm: [
    ["1","1．支援が不要"],
    ["2","2．支援・配慮が必要"],
    ["3","3．判断できない／著しく困難"],
  ],
  medical: [
    ["1","1．ない"],
    ["2","2．ある"],
  ],
  extra: [
    ["1","1．なし／該当なし"],
    ["2","2．軽度"],
    ["3","3．中等度"],
    ["4","4．重度"],
    ["5","5．最重度"],
    ["6","6．その他"],
  ]
};

let state = {
  resident:"",
  date: nowDateStr(),
  interview:"",
  answers: Object.fromEntries([...BASE80, ...EXTRAS].map(it=>["F"+it.row, null])),
  memos: Object.fromEntries([...BASE80, ...EXTRAS].map(it=>["F"+it.row, ""])),
};

function catFor(it){
  return it.cat || "daily";
}
function catLabel(cat){
  return {
    physical:"身体介助",
    daily:"日常生活",
    behavior:"行動障害",
    comm:"意思疎通",
    medical:"特別な医療",
    extra:"追加"
  }[cat] || cat;
}
function escapeHtml(s){
  return (s||"").replace(/[&<>"']/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
}
function highSupport(it, v){
  const cat=catFor(it);
  if(v==null) return false;
  const n=Number(v);
  if(cat==="physical") return n>=3;
  if(cat==="daily") return n>=3;
  if(cat==="behavior") return n>=4;
  if(cat==="comm") return n>=2;
  if(cat==="medical") return n>=2;
  return n>=3;
}

function renderList(list, mountId){
  const q=($("q").value||"").trim().toLowerCase();
  const show=$("showFilter").value;

  const wrap=$(mountId);
  const html=list.filter(it=>{
      const code = (it.code||"").toLowerCase();
      const name = (it.name||"").toLowerCase();
      const hit = !q || name.includes(q) || code.includes(q);
      const v = state.answers["F"+it.row];
      const miss = (v==null);
      const hitShow = (show==="all") || (show==="missing" && miss) || (show==="high" && highSupport(it,v));
      return hit && hitShow;
    }).map(it=>{
      const key="F"+it.row;
      const v=state.answers[key];
      const memo=state.memos[key]||"";
      const cat=catFor(it);
      const need = (v!=null) && (cat==="medical" ? Number(v)===2 : Number(v)>=2);

      let labels = LABELS[cat] || LABELS.extra;
      // extras: adapt length by optCount if available
      if(cat==="extra" && it.optCount){
        const n = Math.max(2, Math.min(6, it.optCount)); // cap display
        labels = LABELS.extra.slice(0,n);
      }
      // medical rows with 2 options: keep
      const opts = labels.map(([val,lab])=>{
        const optNeed = (cat==="medical" ? String(val)==="2" : String(val)!=="1");
        return `
        <label class="opt ${optNeed?'need-opt':''}">
          <input type="radio" name="${key}" value="${val}" ${String(v)===String(val)?"checked":""}>
          <div><div class="t">${lab}</div></div>
        </label>
      `;
      }).join("");

      return `
        <div class="item ${need?'need-card':''}" data-row="${it.row}">
          <div class="top">
            <div>
              <div class="code">${it.code?it.code:""} <span class="small">${escapeHtml(it.group||"")}</span></div>
              <div class="name">${escapeHtml(it.name)}</div>
              <div class="grp">${escapeHtml(catLabel(cat))}</div>
            </div>
            <div class="pill ${need?'need-badge':''}">${v==null?'<span class="warn">未入力</span>':(need?'<span class="warn">支援あり</span>':'<span class="ok">支援なし</span>')}</div>
          </div>
          <div class="opts">${opts}</div>
          <label style="margin-top:8px">根拠メモ（特記事項向け）</label>
          <input class="memo" placeholder="例：頻度・状況・支援者・リスクを書いておくと強い" value="${escapeHtml(memo)}" />
        </div>
      `;
    }).join("");
  wrap.innerHTML = html || `<div class="muted">（該当なし）</div>`;

  wrap.querySelectorAll("input[type=radio]").forEach(inp=>{
    inp.addEventListener("change", e=>{
      const key=e.target.name;
      state.answers[key]=Number(e.target.value);
      updateAll(false);
    });
  });
  wrap.querySelectorAll("input.memo").forEach(inp=>{
    const row=inp.closest(".item").getAttribute("data-row");
    const key="F"+row;
    inp.addEventListener("input", e=>{
      state.memos[key]=e.target.value||"";
    });
  });
}

function calcMissing(){
  const miss = BASE80.filter(it=>state.answers["F"+it.row]==null);
  $("kpiMissing").textContent = miss.length;
  $("missingList").innerHTML = miss.slice(0,30).map(it=>`・${it.code} ${escapeHtml(it.name)}`).join("<br>") || `<span class="ok">未入力なし</span>`;
}

/* ====== 八咫烏015 計算エンジン（最小Excel評価器） ====== */
const cache = new Map();

function getCell(addr){
  if(cache.has(addr)) return cache.get(addr);
  if(/^F\d+$/.test(addr)){
    const v = state.answers[addr];
    const out = (v==null ? "" : v);
    cache.set(addr, out);
    return out;
  }
  if(Object.prototype.hasOwnProperty.call(FORMULAS, addr)){
    const v = evalFormula(FORMULAS[addr]);
    cache.set(addr, v);
    return v;
  }
  if(Object.prototype.hasOwnProperty.call(VALUES, addr)){
    cache.set(addr, VALUES[addr]);
    return VALUES[addr];
  }
  cache.set(addr, 0);
  return 0;
}

function getNamed(name){
  const ref = DEFINED[name];
  if(!ref) return 0;
  return Number(getCell(ref)) || 0;
}

function rangeCells(a,b){
  const colToNum = (c)=> c.split("").reduce((n,ch)=> n*26 + (ch.charCodeAt(0)-64), 0);
  const numToCol = (n)=>{let s=""; while(n>0){let r=(n-1)%26; s=String.fromCharCode(65+r)+s; n=Math.floor((n-1)/26);} return s;};
  const parse = (s)=>{const m=/^([A-Z]+)(\d+)$/.exec(s); return {c:m[1], r:+m[2]};};
  const A=parse(a), B=parse(b);
  const c1=colToNum(A.c), c2=colToNum(B.c);
  const out=[];
  for(let rr=A.r; rr<=B.r; rr++) for(let cc=c1; cc<=c2; cc++) out.push(`${numToCol(cc)}${rr}`);
  return out;
}

function splitTop(s){
  const out=[]; let cur=""; let depth=0; let inq=false;
  for(let i=0;i<s.length;i++){
    const ch=s[i];
    if(ch==='"'){inq=!inq; cur+=ch; continue;}
    if(inq){cur+=ch; continue;}
    if(ch==="(") depth++;
    if(ch===")") depth--;
    if(ch==="," && depth===0){out.push(cur.trim()); cur=""; continue;}
    cur+=ch;
  }
  out.push(cur.trim());
  return out;
}

function evalFormula(f){
  let s=(f||"").trim();
  if(s.startsWith("=")) s=s.slice(1);

  s = s.replace(/SUM\((\$?[A-Z]{1,3}\$?\d+):(\$?[A-Z]{1,3}\$?\d+)\)/gi, (_,a,b)=>{
    a=a.replaceAll("$",""); b=b.replaceAll("$","");
    const cells=rangeCells(a,b);
    const sum=cells.reduce((t,addr)=> t + (Number(getCell(addr))||0), 0);
    return String(sum);
  });

  if(/^IF\(/i.test(s)){
    const inner=s.slice(3,-1);
    const parts=splitTop(inner);
    const ok = !!evalExpr(parts[0]);
    return ok ? evalExpr(parts[1]) : evalExpr(parts[2]);
  }

  if(/^CHOOSE\(/i.test(s)){
    const inner=s.slice(7,-1);
    const parts=splitTop(inner);
    const idx=Math.floor(Number(evalExpr(parts[0]))||0);
    const arr=parts.slice(1).map(x=>Number(evalExpr(x))||0);
    if(idx<=0) return 0;
    return arr[idx-1] ?? 0;
  }

  return evalExpr(s);
}

function evalExpr(expr){
  let e=String(expr).trim();
  if(e==="") return 0;

  e = e.replace(/\$?([A-Z]{1,3})\$?(\d+)/g, (_,c,r)=> String(getCell(`${c}${r}`)));
  e = e.replace(/\bF(\d+)\b/g, (_,r)=> String(getCell(`F${r}`)));

  e = e.replace(/([A-Za-z_][A-Za-z0-9_]*|[\u3040-\u30FF\u4E00-\u9FFFー]+)/g, (m)=>{
    if(m==="IF"||m==="CHOOSE"||m==="SUM") return m;
    if(Object.prototype.hasOwnProperty.call(DEFINED,m)) return String(getNamed(m));
    return m;
  });

  e = e.replace(/([^<>])=([^=])/g, "$1==$2");

  if(!/^[0-9eE\.+\-*/()\s<>=!]+$/.test(e)) return 0;

  try{
    // eslint-disable-next-line no-new-func
    return Function(`"use strict";return (${e});`)();
  }catch{
    return 0;
  }
}

function estimate(){
  cache.clear();
  let best=null;
  for(const r of RULES){
    let ok=true;
    for(const c of r.conds){
      const res = evalExpr(c);
      if(!res){ ok=false; break; }
    }
    if(!ok) continue;
    if(!best || r.p>best.p || (r.p===best.p && r.n>best.n)) best=r;
  }

  if(!best){
    $("kpiKubun").textContent = "—";
    $("kpiLogic").textContent = "—";
    $("kpiP").textContent = "—";
    $("why").innerHTML = `<span class="warn">一致するロジックなし（未入力が多い可能性）</span>`;
    return;
  }
  $("kpiKubun").textContent = best.k;
  $("kpiLogic").textContent = best.n;
  $("kpiP").textContent = best.p;
  $("why").innerHTML = best.conds.slice(0,40).map(x=>`・${escapeHtml(x)}`).join("<br>") + (best.conds.length>40?`<br>…（${best.conds.length}件）`:"");
}

function buildDraft(){
  const lines=[];
  lines.push("【特記事項（下書き）】");
  lines.push("");
  lines.push("■生活状況・支援実態（聞き取り）");
  lines.push((state.interview||"（未記入）").trim() || "（未記入）");
  lines.push("");
  lines.push("■支援が重い／頻度が高い項目（根拠メモつき）");
  const picks = BASE80.filter(it=>highSupport(it, state.answers["F"+it.row])).map(it=>{
    const v=state.answers["F"+it.row];
    const memo=(state.memos["F"+it.row]||"").trim();
    return `・${it.code} ${it.name}：${v}${memo?`（根拠：${memo}）`:""}`;
  });
  lines.push(picks.length? picks.join("\n") : "（該当なし）");
  lines.push("");
  lines.push("■不足項目");
  const miss = BASE80.filter(it=>state.answers["F"+it.row]==null).map(it=>`${it.code} ${it.name}`);
  lines.push(miss.length? miss.join("、 ") : "なし");
  return lines.join("\n");
}

function updateAll(rerender=true){
  state.resident = $("resident").value || "";
  state.date = $("date").value || nowDateStr();
  state.interview = $("interview").value || "";
  if(rerender){
    renderList(BASE80, "items80");
    renderList(EXTRAS, "itemsExtra");
  }
  calcMissing();
  estimate();
}

$("resident").addEventListener("input", ()=>updateAll(false));
$("date").addEventListener("change", ()=>updateAll(false));
$("interview").addEventListener("input", ()=>{ state.interview=$("interview").value||""; });
$("q").addEventListener("input", ()=>updateAll(true));
$("showFilter").addEventListener("change", ()=>updateAll(true));

$("btnDraft").addEventListener("click", ()=>{ $("draft").value = buildDraft(); });
$("btnCopyDraft").addEventListener("click", async ()=>{
  try{ await navigator.clipboard.writeText($("draft").value||""); alert("コピーしました"); }
  catch{ alert("コピーに失敗しました"); }
});

$("btnSave").addEventListener("click", ()=>{
  if(!state.resident.trim()) return alert("利用者名（またはID）を入力してください");
  localStorage.setItem(LS_KEY, JSON.stringify(state));
  alert("保存しました");
});

$("btnReset").addEventListener("click", ()=>{
  if(!confirm("入力をリセットします。よろしいですか？")) return;
  state.resident=""; state.date=nowDateStr(); state.interview="";
  for(const k of Object.keys(state.answers)) state.answers[k]=null;
  for(const k of Object.keys(state.memos)) state.memos[k]="";
  $("resident").value=""; $("date").value=state.date; $("interview").value=""; $("draft").value="";
  updateAll(true);
});

$("btnExport").addEventListener("click", ()=>{
  const blob = new Blob([JSON.stringify(state,null,2)], {type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download = `kubun_yatagarasu015_${(state.resident||"user").replace(/\s+/g,"_")}_${state.date||nowDateStr()}.json`;
  a.click();
  URL.revokeObjectURL(a.href);
});

$("btnImport").addEventListener("click", ()=>{
  const inp=document.createElement("input");
  inp.type="file"; inp.accept="application/json";
  inp.onchange=async()=>{
    const f=inp.files?.[0]; if(!f) return;
    try{
      const obj=JSON.parse(await f.text());
      if(!obj.answers || !obj.memos) throw new Error("bad");
      state = obj;
      $("resident").value=state.resident||"";
      $("date").value=state.date||nowDateStr();
      $("interview").value=state.interview||"";
      updateAll(true);
      alert("インポートしました");
    }catch(e){ alert("インポートに失敗しました"); }
  };
  inp.click();
});

// Excel出力（.xlsx、支援ありを赤）
function getAnswerLabel(cat, v){
  const labels = LABELS[cat] || LABELS.extra;
  const hit = labels.find(x=>String(x[0])===String(v));
  return hit ? hit[1] : (v==null? "" : String(v));
}
function isSupportNeeded(cat, v){
  if(v==null) return false;
  if(cat==="medical") return Number(v)===2;
  return Number(v)>=2; // 身体介助/日常生活/行動障害/意思疎通：2以上は支援あり
}
function exportXlsx(){
  if(typeof XLSX === "undefined"){
    alert("Excel出力ライブラリの読み込みに失敗しました（通信環境を確認してください）");
    return;
  }
  const resident = ($("resident").value||"").trim();
  const date = ($("date").value||nowDateStr()).trim();
  const estKubun = ($("kpiKubun").textContent||"").trim();
  const logic = ($("kpiLogic").textContent||"").trim();
  const p = ($("kpiP").textContent||"").trim();

  const overview = [
    ["利用者", resident],
    ["日付", date],
    ["推定区分（八咫烏015）", estKubun],
    ["該当ロジック", logic],
    ["p", p],
    ["聞き取りメモ", ($("interview").value||"").trim()],
  ];
  const ws0 = XLSX.utils.aoa_to_sheet(overview);

  const header = ["No","カテゴリ","項目名","回答番号","回答","根拠メモ"];
  const rows = [header];
  for(const it of BASE80){
    const key="F"+it.row;
    const v=state.answers[key];
    const cat=catFor(it);
    rows.push([
      it.code,
      catLabel(cat),
      it.name,
      v==null? "" : v,
      getAnswerLabel(cat, v),
      (state.memos[key]||"").trim()
    ]);
  }
  const ws1 = XLSX.utils.aoa_to_sheet(rows);

  const redFill = { patternType:"solid", fgColor:{rgb:"FFFEE2E2"} };
  const redFont = { color:{rgb:"FFB91C1C"}, bold:true };

  for(let r=1; r<rows.length; r++){
    const it = BASE80[r-1];
    const key="F"+it.row;
    const v=state.answers[key];
    const cat=catFor(it);
    if(isSupportNeeded(cat, v)){
      const addrNum = XLSX.utils.encode_cell({r:r, c:3});
      const addrLab = XLSX.utils.encode_cell({r:r, c:4});
      if(ws1[addrNum]) ws1[addrNum].s = { fill:redFill, font:redFont };
      if(ws1[addrLab]) ws1[addrLab].s = { fill:redFill, font:redFont };
    }
  }
  for(let c=0;c<header.length;c++){
    const a = XLSX.utils.encode_cell({r:0,c});
    if(ws1[a]) ws1[a].s = { font:{bold:true} };
  }

  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws0, "概要");
  XLSX.utils.book_append_sheet(wb, ws1, "80項目");

  const filename = `kubun_${resident||"user"}_${date||nowDateStr()}.xlsx`.replace(/\s+/g,"_");
  XLSX.writeFile(wb, filename);
}
$("btnXlsx").addEventListener("click", exportXlsx);

// initial render
renderList(BASE80, "items80");
renderList(EXTRAS, "itemsExtra");
updateAll(false);
</script>
</body>
</html>
